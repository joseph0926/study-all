# Transcript: useRef ì‹¤ë¬´ íŒ¨í„´
> ë‚ ì§œ: 2026-03-02 | í´ë¼ì´ì–¸íŠ¸: claude-code | ë©”ì‹œì§€: 74ê°œ

---

## [11:05:37] AI

ì†ŒìŠ¤ ê·¼ê±°ë¥¼ íƒìƒ‰í•˜ê² ìŠµë‹ˆë‹¤.

---

## [11:05:43] AI



> ë„êµ¬ í˜¸ì¶œ: Agent

---

## [11:05:44] AI



> ë„êµ¬ í˜¸ì¶œ: Grep

---

## [11:07:04] AI



> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 0 | ê²½ê³¼: 2ë¶„

React ì†ŒìŠ¤ì½”ë“œì—ì„œ ì‹¤ë¬´ íŒ¨í„´ ê·¼ê±°ë¥¼ í™•ë³´í–ˆìŠµë‹ˆë‹¤. 7ê°€ì§€ í•µì‹¬ íŒ¨í„´ì„ ë°œê²¬í–ˆê³ , ref/react/ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.

---

## useRef ì‹¤ë¬´ íŒ¨í„´ â€” íƒìƒ‰ ì‹œì‘

ì˜¤ëŠ˜ ë‹¤ë£° íŒ¨í„´ ë§µì…ë‹ˆë‹¤:

```
useRef ì‹¤ë¬´ íŒ¨í„´
â”œâ”€â”€ 1. íƒ€ì´ë¨¸ ê´€ë¦¬ (debounce/throttle)     â† ref/react í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”œâ”€â”€ 2. Observer ì—°ë™ (Resize/Intersection) â† ref/react fixtures
â”œâ”€â”€ 3. ì´ì „ ê°’ ì¶”ì  (usePrevious)          â† ê³µì‹ ë¬¸ì„œ + ì¶”ë¡ 
â”œâ”€â”€ 4. ì½œë°± ì €ì¥ (ìµœì‹  í•¨ìˆ˜ ì°¸ì¡°)          â† React í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”œâ”€â”€ 5. DOM ëª…ë ¹í˜• ì œì–´ (focus/scroll)      â† ref/react fixtures
â”œâ”€â”€ 6. ë Œë” ì¤‘ Lazy init                   â† useSyncExternalStore ì†ŒìŠ¤
â””â”€â”€ 7. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬        â† ì‹¤ì „ íŒ¨í„´
```

### íŒ¨í„´ 1: íƒ€ì´ë¨¸ ê´€ë¦¬ â€” `useDebouncedCallback`

React ê³µì‹ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ìˆëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

`ref/react/packages/react-reconciler/src/__tests__/useRef-test.internal.js:48-105`

```js
function useDebouncedCallback(callback, ms, inputs) {
  const timeoutID = useRef(-1);           // íƒ€ì´ë¨¸ ID ì €ì¥
  useEffect(() => {
    return function unmount() {
      clearTimeout(timeoutID.current);    // ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬
    };
  }, []);
  const debouncedCallback = useCallback(
    (...args) => {
      clearTimeout(timeoutID.current);    // ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ
      timeoutID.current = setTimeout(callback, ms, ...args);  // ìƒˆ íƒ€ì´ë¨¸
    },
    [callback, ms],
  );
  return useCallback(debouncedCallback, inputs);
}
```

**ë¹„ìœ : ì—˜ë¦¬ë² ì´í„° ë¬¸**

| ì‹¤ìƒí™œ | ì½”ë“œ |
|---------|------|
| ëˆ„êµ°ê°€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¬¸ ë‹«ê¸° 3ì´ˆ íƒ€ì´ë¨¸ ì‹œì‘ | `setTimeout(callback, ms)` |
| íƒ€ì´ë¨¸ ì¤‘ì— ë˜ ëˆ„ë¥´ë©´ **ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ**, ìƒˆë¡œ 3ì´ˆ | `clearTimeout(timeoutID.current)` â†’ ìƒˆ `setTimeout` |
| íƒ€ì´ë¨¸ ë²ˆí˜¸ë¥¼ **ë©”ëª¨ì¥ì— ì ì–´ë‘ ** (í™”ë©´ì— í‘œì‹œí•  í•„ìš” ì—†ìŒ) | `timeoutID = useRef(-1)` |
| ì—˜ë¦¬ë² ì´í„° ì² ê±° ì‹œ íƒ€ì´ë¨¸ë„ ì •ë¦¬ | `useEffect cleanup â†’ clearTimeout` |

**ì™œ useStateê°€ ì•„ë‹ˆë¼ useRefì¸ê°€?**

íƒ€ì´ë¨¸ IDëŠ” í™”ë©´ì— í‘œì‹œí•  ê°’ì´ ì•„ë‹™ë‹ˆë‹¤. `useState`ë¡œ ì €ì¥í•˜ë©´ `setTimeoutID(newId)` í˜¸ì¶œë§ˆë‹¤ **ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§**ì´ ë°œìƒí•©ë‹ˆë‹¤. refëŠ” ê°’ì„ ë°”ê¿”ë„ ë¦¬ë Œë” ì—†ì´ ì¡°ìš©íˆ ë³´ê´€í•©ë‹ˆë‹¤.

---

ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? ì´ íŒ¨í„´ì— ëŒ€í•´ ì§ˆë¬¸í•˜ì…”ë„ ë˜ê³ , ë‹¤ë¥¸ íŒ¨í„´ìœ¼ë¡œ ë„˜ì–´ê°€ë„ ë©ë‹ˆë‹¤. ìµœì†Œ Q&A 3íšŒë¥¼ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

---

## [11:13:29] ì‚¬ìš©ì

ê·¸ëŸ¬ë©´ ìµœì´ˆ useDebouncedCallback(() => console.log("test"), 100, inputsì™œ í•„ìš”í•˜ì§€..?) í˜¸ì¶œì‹œì—ëŠ”
1. const timeoutID = useRef(-1); ë¼ì¸ ì‹¤í–‰ -> timeoutID = {current: -1}
2. clearTimeout(timeoutID.current); ë¼ì¸ ì‹¤í–‰ -> ì´ë•Œ timeoutIDëŠ” timeout íƒ€ì…ì´ ì•„ë‹ˆì§€ ì•Šë‚˜?
3. timeoutID.current = setTimeout(callback, ms, ...args); ë¼ì¸ ì‹¤í–‰ -> ì´ë•Œì•¼ timeoutIDì— timeout íƒ€ì…ì´ í• ë‹¹?

---

## [11:14:02] AI

> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 1 | ê²½ê³¼: 4ë¶„

ì¢‹ì€ ê´€ì°°ì…ë‹ˆë‹¤. íë¦„ ì¶”ì ì´ ì •í™•í•©ë‹ˆë‹¤. í•µì‹¬ì€ 2ë²ˆì˜ `clearTimeout(-1)`ì´ ì•ˆì „í•œê°€ì…ë‹ˆë‹¤.

---

## `clearTimeout`ì˜ ìŠ¤í™: ì˜ëª»ëœ IDëŠ” ë¬´ì‹œ

HTML ìŠ¤í™(WHATWG Timer)ì— ì´ë ‡ê²Œ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

> "If handle does not map to an entry in the active timers map, **do nothing**."
> â€” WHATWG HTML Spec, Timers (2025)

```
clearTimeout(-1)   â†’ ë§¤í•‘ ì—†ìŒ â†’ ì•„ë¬´ ì¼ë„ ì•ˆ í•¨ âœ“
clearTimeout(0)    â†’ ë§¤í•‘ ì—†ìŒ â†’ ì•„ë¬´ ì¼ë„ ì•ˆ í•¨ âœ“
clearTimeout(null) â†’ ë§¤í•‘ ì—†ìŒ â†’ ì•„ë¬´ ì¼ë„ ì•ˆ í•¨ âœ“
```

ì—ëŸ¬ë¥¼ ë˜ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. **ì„¤ê³„ ì˜ë„ì ìœ¼ë¡œ ì•ˆì „**í•©ë‹ˆë‹¤.

---

## ìµœì´ˆ í˜¸ì¶œ íë¦„ (ì •í™•í•œ ì¶”ì )

```
useDebouncedCallback(() => console.log("test"), 100, [deps])

â”€â”€ ë Œë”ë§ ì‹œ â”€â”€
â‘  useRef(-1)              â†’ timeoutID = { current: -1 }
â‘¡ useEffect ë“±ë¡          â†’ cleanup í•¨ìˆ˜ ì˜ˆì•½ (ì•„ì§ ì‹¤í–‰ ì•ˆ ë¨)
â‘¢ useCallback ìƒì„±        â†’ debouncedCallback í•¨ìˆ˜ ìƒì„±
â‘£ return                  â†’ ì‚¬ìš©ìì—ê²Œ debouncedCallback ë°˜í™˜

â”€â”€ ì‚¬ìš©ìê°€ debouncedCallback() í˜¸ì¶œ ì‹œ â”€â”€
â‘¤ clearTimeout(-1)        â†’ ë§¤í•‘ ì—†ìŒ â†’ ë¬´ì‹œ (ì•ˆì „)
â‘¥ setTimeout(cb, 100)     â†’ íƒ€ì´ë¨¸ ìƒì„±, ID ë°˜í™˜ (ì˜ˆ: 42)
â‘¦ timeoutID.current = 42  â†’ ì´ì œì•¼ ìœ íš¨í•œ íƒ€ì´ë¨¸ ID ì €ì¥

â”€â”€ 100ms ë‚´ì— ë‹¤ì‹œ í˜¸ì¶œ ì‹œ â”€â”€
â‘§ clearTimeout(42)        â†’ ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ âœ“
â‘¨ setTimeout(cb, 100)     â†’ ìƒˆ íƒ€ì´ë¨¸ ID (ì˜ˆ: 43)
â‘© timeoutID.current = 43
```

**ë¹„ìœ **: `-1`ì€ "ì•„ì§ ë©”ëª¨ì¥ì— ì•„ë¬´ê²ƒë„ ì•ˆ ì ì€ ìƒíƒœ"ì…ë‹ˆë‹¤. "ì—†ëŠ” ë²ˆí˜¸ë¥¼ ì§€ìš°ì„¸ìš”"ë¼ê³  í•´ë„ ì—˜ë¦¬ë² ì´í„° ì‹œìŠ¤í…œì´ "ê·¸ëŸ° ë²ˆí˜¸ ì—†ëŠ”ë°ìš”, ë„˜ì–´ê°ˆê²Œìš”"ë¼ê³  ë¬´ì‹œí•  ë¿ì…ë‹ˆë‹¤.

---

## ì™œ ì´ˆê¸°ê°’ì´ `-1`ì´ê³  `null`ì´ ì•„ë‹Œê°€?

íƒ€ì… ê´€ì ì—ì„œ ë³´ë©´:

```ts
// ë¸Œë¼ìš°ì €: setTimeout ë°˜í™˜ íƒ€ì…ì€ number
const id: number = setTimeout(() => {}, 100);

// -1ì€ number â†’ íƒ€ì… ì¼ê´€ì„± ìœ ì§€
const timeoutID = useRef(-1);        // useRef<number>  âœ“

// nullì„ ì“°ë©´:
const timeoutID = useRef(null);      // useRef<null> â†’ ë‚˜ì¤‘ì— number í• ë‹¹ ì‹œ íƒ€ì… ì—ëŸ¬
const timeoutID = useRef<number | null>(null);  // ë§¤ë²ˆ null ì²´í¬ í•„ìš”
```

`-1`ì€ ìœ íš¨í•œ íƒ€ì´ë¨¸ IDê°€ ì ˆëŒ€ ë  ìˆ˜ ì—†ëŠ” ê°’(`setTimeout`ì€ ì–‘ìˆ˜ ë°˜í™˜)ì´ë©´ì„œ íƒ€ì…ì´ `number`ë¡œ ì¼ê´€ë©ë‹ˆë‹¤. **ì„¼í‹°ë„¬ ê°’(sentinel value)** íŒ¨í„´ì…ë‹ˆë‹¤.

---

## `inputs`ì— ëŒ€í•´

ê´„í˜¸ ì•ˆì— "ì™œ í•„ìš”í•˜ì§€?"ë¼ê³  ì“°ì…¨ëŠ”ë° â€” ì´ `inputs`ëŠ” `useCallback`ì˜ deps ë°°ì—´ì…ë‹ˆë‹¤. `debouncedCallback`ì„ ë©”ëª¨ì´ì œì´ì…˜í•  ë•Œ ì–´ë–¤ ì˜ì¡´ì„±ì´ ë°”ë€Œë©´ ìƒˆ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì§€ ê²°ì •í•©ë‹ˆë‹¤. ë‹¤ë§Œ ì´ ì½”ë“œëŠ” `useCallback`ì„ ì´ì¤‘ìœ¼ë¡œ ê°ì‹¸ê³  ìˆì–´ì„œ ì‚¬ì‹¤ ì¢€ ê³¼í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.

---

ë‹¤ìŒ ì§ˆë¬¸ì´ ìˆìœ¼ì‹ ê°€ìš”? ë˜ëŠ” íŒ¨í„´ 2(Observer ì—°ë™)ë¡œ ë„˜ì–´ê°ˆê¹Œìš”?

---

## [11:15:12] ì‚¬ìš©ì

ë„¤

---

## [11:15:24] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:15:29] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [11:15:29] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [11:15:53] AI

> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 1 | ê²½ê³¼: 5ë¶„

### íŒ¨í„´ 2: Observer ì—°ë™ â€” ResizeObserver / IntersectionObserver

React ê³µì‹ fixture ì½”ë“œì—ì„œ ë‘ ê°€ì§€ Observer íŒ¨í„´ì„ ë´…ì‹œë‹¤.

---

**A) ResizeObserver** (`ref/react/fixtures/dom/src/components/fixtures/fragment-refs/ResizeObserverCase.js:7-30`)

```js
function ResizeObserverCase() {
  const fragmentRef = useRef(null);              // â‘  DOM ì°¸ì¡°
  const [width, setWidth] = useState([0, 0, 0]); // í™”ë©´ì— ë³´ì—¬ì¤„ ê°’ì€ state

  useEffect(() => {
    const resizeObserver = new ResizeObserver(entries => {
      // Observer ì½œë°± â†’ state ê°±ì‹  (í™”ë©´ ë°˜ì˜ í•„ìš”í•˜ë¯€ë¡œ setState)
      setWidth(prev => { /* ... */ });
    });

    fragmentRef.current.observeUsing(resizeObserver);   // â‘¡ refë¡œ DOM ì ‘ê·¼

    const lastFragmentRefValue = fragmentRef.current;    // â‘¢ ìº¡ì²˜!
    return () => {
      lastFragmentRefValue.unobserveUsing(resizeObserver); // â‘£ ìº¡ì²˜ëœ ê°’ìœ¼ë¡œ ì •ë¦¬
    };
  }, []);
}
```

**B) IntersectionObserver** (`IntersectionObserverCase.js:25-58`)

```js
const fragmentRef = useRef(null);     // DOM ì°¸ì¡°
const observerRef = useRef(null);     // â˜… Observer ì¸ìŠ¤í„´ìŠ¤ë„ refë¡œ ê´€ë¦¬

useEffect(() => {
  if (observerRef.current === null) {              // Lazy init
    observerRef.current = new IntersectionObserver(/* ... */);
  }
  fragmentRef.current.observeUsing(observerRef.current);

  const lastFragmentRefValue = fragmentRef.current;
  return () => {
    lastFragmentRefValue.unobserveUsing(observerRef.current);
    observerRef.current = null;                    // cleanup ì‹œ í•´ì œ
  };
}, []);
```

---

### í•µì‹¬ í¬ì¸íŠ¸ 3ê°€ì§€

**1) refê°€ 2ê°œ â€” ì—­í• ì´ ë‹¤ë¥´ë‹¤**

```
fragmentRef  â†’ DOM ìš”ì†Œ ì°¸ì¡°    (ê´€ì°° ëŒ€ìƒ)
observerRef  â†’ Observer ì¸ìŠ¤í„´ìŠ¤ (ê´€ì°°ì ìì²´)
```

ë‘˜ ë‹¤ ë Œë”ë§ê³¼ ë¬´ê´€í•œ ê°’ì´ë¯€ë¡œ refì…ë‹ˆë‹¤.

**2) cleanupì—ì„œ `ref.current`ë¥¼ ì§ì ‘ ì“°ì§€ ì•ŠëŠ”ë‹¤**

```js
// âœ— ìœ„í—˜
return () => {
  fragmentRef.current.unobserveUsing(resizeObserver);
};

// âœ“ ì•ˆì „ â€” ìº¡ì²˜
const lastFragmentRefValue = fragmentRef.current;
return () => {
  lastFragmentRefValue.unobserveUsing(resizeObserver);
};
```

**ë¹„ìœ : íƒë°° ê¸°ì‚¬ì˜ ì£¼ì†Œë¡**

| ì‹¤ìƒí™œ | ì½”ë“œ |
|---------|------|
| ë°°ë‹¬ ì‹œì‘ ì‹œ ì£¼ì†Œë¥¼ **ë©”ëª¨ì§€ì— ë³µì‚¬** | `const last = fragmentRef.current` |
| ë°˜í’ˆ ì‹œ **ë©”ëª¨ì§€ì˜ ì£¼ì†Œ**ë¡œ ë°©ë¬¸ | cleanupì—ì„œ `last.unobserve()` |
| ë§Œì•½ ì›ë³¸ ì£¼ì†Œë¡ì´ ê°±ì‹ ëë‹¤ë©´? ë©”ëª¨ì§€ê°€ ì—†ìœ¼ë©´ **ì—‰ëš±í•œ ê³³ìœ¼ë¡œ ë°˜í’ˆ** | cleanup ì‹œ `ref.current`ê°€ ì´ë¯¸ ë‹¤ë¥¸ DOMì„ ê°€ë¦¬í‚¬ ìˆ˜ ìˆìŒ |

**3) Observerì˜ Lazy init íŒ¨í„´**

```js
if (observerRef.current === null) {
  observerRef.current = new IntersectionObserver(/* ... */);
}
```

ì´ì „ í•™ìŠµì—ì„œ ë‹¤ë¤˜ë˜ **ë Œë” ì¤‘ Lazy init**ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” **useEffect ì•ˆ**ì—ì„œ í•©ë‹ˆë‹¤. Effect ì•ˆì´ë¯€ë¡œ Concurrent Mode tearing ë¬¸ì œëŠ” ì—†ê³ , ë‹¨ìˆœíˆ "ì´ë¯¸ ë§Œë“¤ì–´ì ¸ ìˆìœ¼ë©´ ì¬ìƒì„±í•˜ì§€ ì•Šê² ë‹¤"ëŠ” íš¨ìœ¨ íŒ¨í„´ì…ë‹ˆë‹¤.

---

ì§ˆë¬¸ ìˆìœ¼ì‹ ê°€ìš”?

---

## [11:20:02] ì‚¬ìš©ì

1. fragmentRef.current.observeUsing(resizeObserver);   // â‘¡ refë¡œ DOM ì ‘ê·¼ << ì´ë•Œ fragmentRef.currentëŠ” null ì•„ë‹Œê°€ìš”?
2. ì™œ ìœ„í—˜í•œì§€ ì˜ ì´í•´ê°€ ì•ˆê°€ëŠ”ë°ìš”, ê·¸ëƒ¥ fragmentRef.currentì„ í´ë¦°ì—…í•˜ë©´ fragmentRef.currentê°€ ìµœì´ˆì—ëŠ” <div> DOMì˜ refì˜€ê³ , ê·¸ê±¸ í´ë¦°ì—…í• ê±¸ ê¸°ëŒ€í–ˆì§€ë§Œ, ì¤‘ê°„ì— <li>ë¡œ ë°”ë€Œì–´ë„ ReactëŠ” ëª¨ë¥¸ë‹¤ << ì´ê²Œ ë§ë‚˜ìš”?

---

## [11:20:29] AI



> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 2 | ê²½ê³¼: 7ë¶„

ë‘ ì§ˆë¬¸ ëª¨ë‘ í•µì‹¬ì„ ì°Œë¦…ë‹ˆë‹¤.

---

## Q1: `fragmentRef.current`ê°€ null ì•„ë‹Œê°€?

ë§ëŠ” ì˜ì‹¬ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì½”ë“œì—ì„œëŠ” nullì´ ì•„ë‹™ë‹ˆë‹¤. íƒ€ì´ë° ë•Œë¬¸ì…ë‹ˆë‹¤.

```
ë Œë”ë§ ë‹¨ê³„          ì»¤ë°‹ ë‹¨ê³„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
JSX ìƒì„±            â‘  DOM ìƒì„±/ì—…ë°ì´íŠ¸
  â”‚                 â‘¡ ref ì—°ê²° (ref.current = DOM)
  â”‚                 â‘¢ useEffect ì‹¤í–‰  â† ì—¬ê¸°ì„œ ref ì ‘ê·¼
  â–¼                     â–¼
```

`useEffect`ëŠ” **ì»¤ë°‹ ì™„ë£Œ í›„** ì‹¤í–‰ë©ë‹ˆë‹¤. ì»¤ë°‹ ë‹¨ê³„ì—ì„œ Reactê°€ `ref.current = DOMë…¸ë“œ`ë¥¼ ë¨¼ì € í• ë‹¹í•˜ê³ , ê·¸ ë‹¤ìŒì— effectê°€ ëŒì•„ê°‘ë‹ˆë‹¤.

ì½”ë“œ ê·¼ê±° â€” commit ìˆœì„œë¥¼ ë³´ë©´:

`ref/react/packages/react-reconciler/src/ReactFiberCommitWork.js`ì—ì„œ commitLayoutEffects(ref ì—°ê²°) â†’ commitPassiveMountEffects(useEffect ì‹¤í–‰) ìˆœì„œë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```
commitMutationEffects   â†’ DOM ë³€ê²½
commitLayoutEffects     â†’ ref.current = DOM  â† ë¨¼ì €
commitPassiveMountEffects â†’ useEffect ì‹¤í–‰    â† ë‚˜ì¤‘
```

ê·¸ë˜ì„œ useEffect ì•ˆì—ì„œ `ref.current`ëŠ” ì´ë¯¸ DOMì„ ê°€ë¦¬í‚¤ê³  ìˆìŠµë‹ˆë‹¤. ë°˜ëŒ€ë¡œ **ë Œë” í•¨ìˆ˜ ë³¸ë¬¸**ì—ì„œ ref.currentë¥¼ ì½ìœ¼ë©´ ì•„ì§ nullì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## Q2: cleanupì—ì„œ `ref.current` ì§ì ‘ ì‚¬ìš©ì´ ìœ„í—˜í•œ ì´ìœ 

ì¶”ë¡  ë°©í–¥ì€ ë§ëŠ”ë°, ì¢€ ë” ì •í™•íˆ í•˜ë©´:

**Reactê°€ ëª¨ë¥´ëŠ” ê²Œ ì•„ë‹ˆë¼, cleanup ì‹¤í–‰ ì‹œì ì— `ref.current`ê°€ ì´ë¯¸ ë‹¤ë¥¸ ê°’ì„ ê°€ë¦¬í‚¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

```
ì‹œì  1: ë§ˆìš´íŠ¸
  fragmentRef.current = <div#A>
  effect ì‹¤í–‰ â†’ observe(<div#A>)

ì‹œì  2: ë¦¬ë Œë” (ìì‹ DOMì´ ë°”ë€œ)
  â‘  Reactê°€ ìƒˆ DOM ì»¤ë°‹
  â‘¡ ref.current = <div#B>          â† refê°€ ìƒˆ DOMìœ¼ë¡œ ê°±ì‹ ë¨
  â‘¢ ì´ì „ effect cleanup ì‹¤í–‰       â† ì´ ì‹œì ì—ì„œ ref.currentëŠ” ì´ë¯¸ <div#B>!
  â‘£ ìƒˆ effect ì‹¤í–‰
```

```js
// âœ— ìœ„í—˜: cleanup ì‹œì ì— ref.currentê°€ ì´ë¯¸ ë°”ë€Œì–´ ìˆìŒ
return () => {
  fragmentRef.current.unobserve(resizeObserver);
  // â†‘ <div#A>ë¥¼ unobserveí•˜ê³  ì‹¶ì—ˆëŠ”ë°
  //   ref.currentëŠ” ì´ë¯¸ <div#B> â†’ <div#A>ëŠ” ì •ë¦¬ ì•ˆ ë¨!
};

// âœ“ ì•ˆì „: í´ë¡œì €ë¡œ ìº¡ì²˜í•œ ê°’ì€ ë³€í•˜ì§€ ì•ŠìŒ
const last = fragmentRef.current;  // last = <div#A> (ê³ ì •)
return () => {
  last.unobserve(resizeObserver);  // <div#A> í™•ì‹¤íˆ ì •ë¦¬ âœ“
};
```

**ë¹„ìœ  ìˆ˜ì •**:

| ìƒí™© | cleanupì—ì„œ ref.current ì§ì ‘ ì‚¬ìš© | ìº¡ì²˜ ì‚¬ìš© |
|------|----------------------------------|----------|
| ì´ì‚¬ ì „ | ì£¼ì†Œë¡: "ì„œìš¸ Aì•„íŒŒíŠ¸" | ë©”ëª¨ì§€: "ì„œìš¸ Aì•„íŒŒíŠ¸" |
| ì´ì‚¬ í›„ | ì£¼ì†Œë¡: "ë¶€ì‚° Bì•„íŒŒíŠ¸"ë¡œ ê°±ì‹ ë¨ | ë©”ëª¨ì§€: "ì„œìš¸ Aì•„íŒŒíŠ¸" ê·¸ëŒ€ë¡œ |
| ë°˜í’ˆ ìš”ì²­ | ì£¼ì†Œë¡ ë³´ê³  ë¶€ì‚°ìœ¼ë¡œ ê° (ì˜ëª»ëœ ê³³!) | ë©”ëª¨ì§€ ë³´ê³  ì„œìš¸ë¡œ ê° (ì •í™•!) |

í•µì‹¬ì€ **"Reactê°€ ëª¨ë¥¸ë‹¤"ê°€ ì•„ë‹ˆë¼ "ref.currentëŠ” mutableì´ë¼ cleanup ì‹¤í–‰ ì‹œì ì— ì´ë¯¸ ê°±ì‹ ë˜ì–´ ìˆë‹¤"**ì…ë‹ˆë‹¤. cleanup í´ë¡œì €ê°€ ë§Œë“¤ì–´ì§„ ì‹œì ê³¼ ì‹¤í–‰ë˜ëŠ” ì‹œì  ì‚¬ì´ì— ref.currentê°€ ë°”ë€” ìˆ˜ ìˆëŠ” ê²ƒì´ ë¬¸ì œì…ë‹ˆë‹¤.

---

ì§ˆë¬¸ ë” ìˆìœ¼ì‹ ê°€ìš”?

---

## [11:22:17] ì‚¬ìš©ì

1. A,B ëª¨ë‘ useEffectì—ì„œ ë”±íˆ DOMì„ ì—°ê²°í•˜ëŠ” ì½”ë“œê°€ ì—†ëŠ”ê±° ì•„ë‹Œê°€ìš”?

---

## [11:22:28] AI



> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 2 | ê²½ê³¼: 9ë¶„

ì •í™•í•œ ê´€ì°°ì…ë‹ˆë‹¤. useEffect ì•ˆì—ì„œ DOMì„ ì—°ê²°í•˜ëŠ” ì½”ë“œëŠ” ì—†ìŠµë‹ˆë‹¤.

refì™€ DOMì˜ ì—°ê²°ì€ **JSXì—ì„œ** ì¼ì–´ë‚©ë‹ˆë‹¤:

```jsx
// ResizeObserverCase.js:43
<Fragment ref={fragmentRef}>
  <div id="0">...</div>
</Fragment>
```

ì´ `ref={fragmentRef}` ì†ì„±ì´ ì»¤ë°‹ ë‹¨ê³„ì—ì„œ Reactê°€ ìë™ìœ¼ë¡œ `fragmentRef.current = DOMë…¸ë“œ`ë¥¼ í• ë‹¹í•˜ëŠ” íŠ¸ë¦¬ê±°ì…ë‹ˆë‹¤.

```
JSX: <Fragment ref={fragmentRef}>
          â”‚
          â–¼ (ì»¤ë°‹ ë‹¨ê³„ì—ì„œ React ë‚´ë¶€ ì²˜ë¦¬)
fragmentRef.current = Fragment DOM ë…¸ë“œ   â† Reactê°€ ì•Œì•„ì„œ ì—°ê²°
          â”‚
          â–¼ (ê·¸ ë‹¤ìŒ)
useEffect ì‹¤í–‰ â†’ fragmentRef.current ì‚¬ìš© ê°€ëŠ¥
```

useEffect ì•ˆì˜ ì½”ë“œëŠ” DOM ì—°ê²°ì´ ì•„ë‹ˆë¼ **ì´ë¯¸ ì—°ê²°ëœ refë¥¼ ì‚¬ìš©í•´ì„œ Observerë¥¼ ë¶™ì´ëŠ” ê²ƒ**ì…ë‹ˆë‹¤:

```js
// "DOM ì—°ê²°" â† ì´ê±° ì•„ë‹˜
// "ì—°ê²°ëœ DOMì— Observer ë“±ë¡" â† ì´ê±°
fragmentRef.current.observeUsing(resizeObserver);
```

ì œê°€ ì£¼ì„ì„ `â‘¡ refë¡œ DOM ì ‘ê·¼`ì´ë¼ê³  ë‹¬ì•˜ëŠ”ë°, "refë¡œ DOM ì—°ê²°"ì²˜ëŸ¼ ì˜¤í•´ë  ìˆ˜ ìˆì—ˆê² ë„¤ìš”. ì •í™•íˆëŠ” **"refë¥¼ í†µí•´ ì´ë¯¸ ì—°ê²°ëœ DOMì— ì ‘ê·¼"**ì…ë‹ˆë‹¤.

---

ì§ˆë¬¸ ë” ìˆìœ¼ì‹ ê°€ìš”? ë˜ëŠ” ë‹¤ìŒ íŒ¨í„´ìœ¼ë¡œ ë„˜ì–´ê°ˆê¹Œìš”?

---

## [11:22:56] ì‚¬ìš©ì

ë‹¤ìŒ

---

## [11:23:07] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:23:12] AI



> ë„êµ¬ í˜¸ì¶œ: Grep

---

## [11:23:13] AI



> ë„êµ¬ í˜¸ì¶œ: Grep

---

## [11:23:18] AI



> ë„êµ¬ í˜¸ì¶œ: Grep

---

## [11:23:18] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [11:23:49] AI

> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 2 | ê²½ê³¼: 10ë¶„

### íŒ¨í„´ 3: ì´ì „ ê°’ ì¶”ì  (prevValue íŒ¨í„´)

React DevTools ì†ŒìŠ¤ì—ì„œ ì‹¤ì œ ì‚¬ìš© ì˜ˆë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.

`ref/react/packages/react-devtools-shared/src/devtools/views/Profiler/SnapshotCommitList.js:105-114`

```js
const prevCommitIndexRef = useRef<number | null>(null);

useEffect(() => {
  if (selectedFilteredCommitIndex !== prevCommitIndexRef.current) {
    prevCommitIndexRef.current = selectedFilteredCommitIndex;  // í˜„ì¬ê°’ ì €ì¥
    if (selectedFilteredCommitIndex !== null && listRef.current !== null) {
      listRef.current.scrollToItem(selectedFilteredCommitIndex);  // ë³€ê²½ ì‹œì—ë§Œ ìŠ¤í¬ë¡¤
    }
  }
}, [listRef, selectedFilteredCommitIndex]);
```

**íŒ¨í„´**: "ê°’ì´ ë°”ë€Œì—ˆì„ ë•Œë§Œ" ì–´ë–¤ ë™ì‘ì„ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ, ì´ì „ ê°’ì„ refì— ì €ì¥í•´ì„œ ë¹„êµí•©ë‹ˆë‹¤.

---

### ì¼ë°˜í™”: `usePrevious` ì»¤ìŠ¤í…€ í›…

React ê³µì‹ ë¬¸ì„œ(react.dev)ì—ì„œ ì†Œê°œí•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤:

```js
function usePrevious(value) {
  const ref = useRef();
  useEffect(() => {
    ref.current = value;    // effectëŠ” ë Œë” í›„ ì‹¤í–‰ â†’ "ì´ì „" ê°’ì´ ë¨
  });
  return ref.current;       // ë Œë” ì‹œì ì—ëŠ” ì•„ì§ ì´ì „ ê°’
}
```

**ë¹„ìœ : ì¼ê¸°ì¥ì˜ "ì–´ì œ ë‚ ì”¨"**

| ì‹¤ìƒí™œ | ì½”ë“œ |
|---------|------|
| ì˜¤ëŠ˜ ì•„ì¹¨ì— ì¼ê¸°ì¥ì„ í´ë©´ **ì–´ì œ ì ì€ ë‚ ì”¨**ê°€ ë³´ì„ | `return ref.current` â†’ ì´ì „ ë Œë”ì˜ ê°’ |
| ì˜¤ëŠ˜ í•˜ë£¨ê°€ ëë‚˜ë©´ **ì˜¤ëŠ˜ ë‚ ì”¨**ë¥¼ ì ìŒ | `useEffect(() => { ref.current = value })` |
| ë‚´ì¼ ì•„ì¹¨ì— í´ë©´ **ì˜¤ëŠ˜ ë‚ ì”¨**ê°€ ë³´ì„ | ë‹¤ìŒ ë Œë”ì—ì„œ `ref.current` = í˜„ì¬ ê°’ |

í•µì‹¬ì€ **íƒ€ì´ë°**ì…ë‹ˆë‹¤:

```
ë Œë” N:
  â‘  return ref.current     â†’ ë Œë” N-1ì˜ ê°’ ë°˜í™˜ (ì´ì „ ê°’)
  â‘¡ í™”ë©´ ì»¤ë°‹
  â‘¢ useEffect ì‹¤í–‰
  â‘£ ref.current = value    â†’ ë Œë” Nì˜ ê°’ ì €ì¥

ë Œë” N+1:
  â‘  return ref.current     â†’ ë Œë” Nì˜ ê°’ ë°˜í™˜ (ì´ì „ ê°’)
  ...
```

**ì´ê±´ "ë Œë” ì¤‘ ref ì½ê¸°"ì¸ë° ê´œì°®ì€ê°€?**

ì´ì „ í•™ìŠµì—ì„œ "ë Œë” ì¤‘ ref.current ì½ê¸°ëŠ” ìœ„í—˜"ì´ë¼ê³  ë°°ì› ì£ . ì´ ê²½ìš°ëŠ”:

- ref.currentë¥¼ ë°”ê¾¸ëŠ” ì£¼ì²´ê°€ **ê°™ì€ ì»´í¬ë„ŒíŠ¸ì˜ useEffectë§Œ** (ì™¸ë¶€ ì´ë²¤íŠ¸ê°€ ì•„ë‹˜)
- useEffectëŠ” ë Œë” í›„ ì‹¤í–‰ â†’ ë‹¤ìŒ ë Œë” ì „ê¹Œì§€ ê°’ì´ ì•ˆì •ì 
- Concurrent Modeì—ì„œ ë Œë”ê°€ ì¬ì‹œë„ë˜ì–´ë„ **ê°™ì€ ì´ì „ ê°’**ì„ ë´„

ì™„ì „íˆ ì•ˆì „í•˜ë‹¤ê³ ëŠ” í•  ìˆ˜ ì—†ì§€ë§Œ, ì‹¤ë¬´ì—ì„œ ë„ë¦¬ ì“°ì´ê³  React íŒ€ë„ ë¬¸ì„œì—ì„œ ì†Œê°œí•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

---

### íŒ¨í„´ 4: ìµœì‹  ì½œë°± ì°¸ì¡° ì €ì¥

React í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ë°œê²¬í•œ íŒ¨í„´ì…ë‹ˆë‹¤.

`ref/react/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js:1430-1467`

```js
function Parent() {
  const updaterRef = useRef(null);
  useEffect(() => {
    return () => {
      updaterRef.current(true);  // cleanupì—ì„œ ìì‹ì˜ setState í˜¸ì¶œ
    };
  }, []);
  return <Child updaterRef={updaterRef} />;
}

function Child({ updaterRef }) {
  const [state, setState] = useState(false);
  useEffect(() => {
    updaterRef.current = setState;  // ìì‹ì´ ìì‹ ì˜ setStateë¥¼ refì— ì €ì¥
  }, []);
  return state;
}
```

ë” í”í•œ ì‹¤ë¬´ íŒ¨í„´ì€ **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìµœì‹  ì°¸ì¡°**ì…ë‹ˆë‹¤:

```js
function useLatestCallback(callback) {
  const ref = useRef(callback);
  useEffect(() => {
    ref.current = callback;     // ë§¤ ë Œë”ë§ˆë‹¤ ìµœì‹  í•¨ìˆ˜ë¡œ ê°±ì‹ 
  });
  return useCallback((...args) => {
    return ref.current(...args); // í˜¸ì¶œ ì‹œì ì— í•­ìƒ ìµœì‹  í•¨ìˆ˜ ì‹¤í–‰
  }, []);
}
```

**ì™œ í•„ìš”í•œê°€?**

```js
// ë¬¸ì œ: useCallbackì˜ depsê°€ ë³µì¡í•´ì§
const handleClick = useCallback(() => {
  console.log(count, name, data);  // ì„¸ ê°’ì— ì˜ì¡´
}, [count, name, data]);           // deps ê´€ë¦¬ ë²ˆê±°ë¡œì›€

// í•´ê²°: refë¡œ í•­ìƒ ìµœì‹  í•¨ìˆ˜ ì°¸ì¡°
const handleClick = useLatestCallback(() => {
  console.log(count, name, data);  // í•­ìƒ ìµœì‹  í´ë¡œì €
});
// handleClick ìì²´ëŠ” ì•ˆì •ì  ì°¸ì¡° â†’ ìì‹ì— ë„˜ê²¨ë„ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë” ì—†ìŒ
```

---

ì§ˆë¬¸ ìˆìœ¼ì‹ ê°€ìš”?

---

## [11:31:12] ì‚¬ìš©ì

íŒ¨í„´3ì€ ê·¸ëŸ¬ë©´ ì•„ë˜ íë¦„ì¸ê°€ìš”?

const Test = () => {
  const [num, setNum] = useState(5)
  const prevValue = usePrevious(num); 
  // 1. ì´ˆê¸°ì— `return ref.current`ì´ë¯€ë¡œ null ë°˜í™˜ë¨
  // 2. ë Œë” í›„ useEffectë¡œ ì¸í•´ ref.currentì— 5ê°€ ì €ì¥ë¨
  // 3. Test ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ì‹œ prevValueëŠ” `return ref.cuurent`ë¡œ 5 ë°˜í™˜
};

---

íŒ¨í„´4ëŠ” íŒ¨í„´3ê³¼ ë¹„ìŠ·í•´ë³´ì´ëŠ”ë° ìµœì‹ ê°’ ë°˜í™˜í•˜ëŠ” ì´ìœ ëŠ” returnì‹œ í•¨ìˆ˜ í˜¸ì¶œì´ë¼ ê·¸ëŸ°ê±´ê°€ìš”?

---

## [11:31:29] AI



> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 3 | ê²½ê³¼: 12ë¶„

---

## íŒ¨í„´ 3 íë¦„: ì •í™•í•©ë‹ˆë‹¤

```
ë Œë” 1: num=5
  â‘  usePrevious(5) â†’ return ref.current â†’ undefined (ì´ˆê¸°ê°’)
  â‘¡ prevValue = undefined
  â‘¢ ì»¤ë°‹ í›„ useEffect â†’ ref.current = 5

ë Œë” 2: num=10 (setNum(10) í˜¸ì¶œë¨)
  â‘  usePrevious(10) â†’ return ref.current â†’ 5 (ì´ì „ ê°’!)
  â‘¡ prevValue = 5
  â‘¢ ì»¤ë°‹ í›„ useEffect â†’ ref.current = 10

ë Œë” 3: num=20
  â‘  usePrevious(20) â†’ return ref.current â†’ 10
  â‘¡ prevValue = 10
  â‘¢ ì»¤ë°‹ í›„ useEffect â†’ ref.current = 20
```

í•œ ê°€ì§€ â€” ì´ˆê¸°ê°’ì€ `null`ì´ ì•„ë‹ˆë¼ `undefined`ì…ë‹ˆë‹¤. `useRef()`ì— ì¸ìë¥¼ ì•ˆ ë„˜ê¸°ë©´ `{current: undefined}`ê°€ ë©ë‹ˆë‹¤.

---

## íŒ¨í„´ 4: ë§ìŠµë‹ˆë‹¤. í•µì‹¬ì€ "ë°˜í™˜ ì‹œì "ì˜ ì°¨ì´

```js
// íŒ¨í„´ 3: usePrevious â€” ê°’ì„ ì§ì ‘ ë°˜í™˜
return ref.current;          // ë Œë” ì‹œì ì˜ ref ê°’ (= ì´ì „ ê°’)

// íŒ¨í„´ 4: useLatestCallback â€” í•¨ìˆ˜ë¥¼ ë°˜í™˜
return useCallback((...args) => {
  return ref.current(...args); // í˜¸ì¶œ ì‹œì ì˜ ref ê°’ (= ìµœì‹  ê°’)
}, []);
```

```
íŒ¨í„´ 3 (ê°’ ë°˜í™˜)              íŒ¨í„´ 4 (í•¨ìˆ˜ ë°˜í™˜)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ë Œë” ì‹œ: ref ì½ê¸°             ë Œë” ì‹œ: í•¨ìˆ˜ ê»ë°ê¸°ë§Œ ë°˜í™˜
  â†’ ì´ì „ ê°’ í™•ì •               â†’ refëŠ” ì•„ì§ ì•ˆ ì½ìŒ
                              
ì»¤ë°‹ í›„: ref ê°±ì‹              ì»¤ë°‹ í›„: ref ê°±ì‹ 
                              
                              ë‚˜ì¤‘ì— í´ë¦­ ë“±ìœ¼ë¡œ í•¨ìˆ˜ í˜¸ì¶œ ì‹œ:
                                â†’ ê·¸ì œì„œì•¼ ref.current ì½ê¸°
                                â†’ ìµœì‹  ê°’!
```

**ë¹„ìœ **: 
- íŒ¨í„´ 3: "ì§€ê¸ˆ ë©”ëª¨ì¥ì— ë­ ì í˜€ìˆì–´?" â†’ ì–´ì œ ì ì€ ê±° ë³´ì—¬ì¤Œ
- íŒ¨í„´ 4: "ë‚˜ì¤‘ì— í•„ìš”í•˜ë©´ ë©”ëª¨ì¥ ë´" â†’ ë³¼ ë•Œ í•­ìƒ ìµœì‹ 

---

ì§ˆë¬¸ ë” ìˆìœ¼ì‹ ê°€ìš”? ë˜ëŠ” ë‚˜ë¨¸ì§€ íŒ¨í„´(DOM ëª…ë ¹í˜• ì œì–´, Lazy init, ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ìŠ¤í„´ìŠ¤)ìœ¼ë¡œ ë„˜ì–´ê°ˆê¹Œìš”?

---

## [11:32:09] ì‚¬ìš©ì

ë„¤ ë‹¤ìŒ

---

## [11:32:33] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:32:35] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [11:32:36] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [11:33:11] AI

> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 3 | ê²½ê³¼: 12ë¶„

### íŒ¨í„´ 5: DOM ëª…ë ¹í˜• ì œì–´ (focus/scroll/measure)

`ref/react/fixtures/dom/src/components/fixtures/fragment-refs/FocusCase.js:8-63`

```js
function FocusCase() {
  const fragmentRef = useRef(null);

  return (
    <>
      <button onClick={() => fragmentRef.current.focus()}>
        Focus first child
      </button>
      <button onClick={() => fragmentRef.current.focusLast()}>
        Focus last child
      </button>
      <button onClick={() => fragmentRef.current.blur()}>Blur</button>

      <Fragment ref={fragmentRef}>
        <div>Unfocusable div</div>
        <button>Button 1</button>
        <input type="text" />
      </Fragment>
    </>
  );
}
```

ì´ê±´ ê°€ì¥ ì§ê´€ì ì¸ íŒ¨í„´ì…ë‹ˆë‹¤. **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì•ˆì—ì„œ** refë¥¼ í†µí•´ DOM APIë¥¼ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.

í•µì‹¬ ê·œì¹™:

```
ref.current.focus()    â†’ âœ“ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì•ˆ (ë Œë” ë°–)
ref.current.focus()    â†’ âœ“ useEffect ì•ˆ (ë Œë” ë°–)
ref.current.focus()    â†’ âœ— ë Œë” í•¨ìˆ˜ ë³¸ë¬¸ (ë Œë” ì¤‘)
```

ì´ê±´ ì´ì „ í•™ìŠµì˜ "ë Œë” ì¤‘ ref ì½ê¸° ê¸ˆì§€" ì›ì¹™ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤. DOM ëª…ë ¹í˜• í˜¸ì¶œì€ í•­ìƒ **ë Œë” ë°”ê¹¥**ì—ì„œ.

---

### íŒ¨í„´ 6: ë Œë” ì¤‘ Lazy init (ì¸ìŠ¤í„´ìŠ¤ ìºì‹œ)

`ref/react/packages/use-sync-external-store/src/useSyncExternalStoreWithSelector.js:37-47`

```js
const instRef = useRef<Inst | null>(null);
let inst: Inst;
if (instRef.current === null) {
  inst = {
    hasValue: false,
    value: null,
  };
  instRef.current = inst;
} else {
  inst = instRef.current;
}
```

ì´ì „ í•™ìŠµì—ì„œ ë‹¤ë¤˜ë˜ **ë©±ë“± ì´ˆê¸°í™” íŒ¨í„´**ì˜ ì‹¤ì „ ì ìš©ì…ë‹ˆë‹¤. React ê³µì‹ ë¼ì´ë¸ŒëŸ¬ë¦¬(`useSyncExternalStoreWithSelector`)ì—ì„œ ì§ì ‘ ì‚¬ìš©í•©ë‹ˆë‹¤.

ê·¸ëŸ°ë° ê°™ì€ íŒŒì¼ì˜ ì£¼ì„ì´ í¥ë¯¸ë¡œìš´ ì ì„ ì•Œë ¤ì¤ë‹ˆë‹¤ (`:50-53`):

```js
// Track the memoized state using closure variables that are local to this
// memoized instance of a getSnapshot function. Intentionally not using a
// useRef hook, because that state would be shared across all concurrent
// copies of the hook/component.
```

**"ì˜ë„ì ìœ¼ë¡œ useRefë¥¼ ì“°ì§€ ì•ŠëŠ”ë‹¤. concurrent copies ê°„ì— ê³µìœ ë˜ë‹ˆê¹Œ."**

ì¦‰ `useMemo` ì•ˆì˜ í´ë¡œì € ë³€ìˆ˜ëŠ” concurrent copyë§ˆë‹¤ ë…ë¦½ì ì´ì§€ë§Œ, `useRef`ëŠ” Fiberì— ì €ì¥ë˜ë¯€ë¡œ ëª¨ë“  concurrent ë Œë”ê°€ **ê°™ì€ refë¥¼ ê³µìœ **í•©ë‹ˆë‹¤. ìš©ë„ì— ë”°ë¼ refë¥¼ ì“¸ì§€, í´ë¡œì €ë¥¼ ì“¸ì§€ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.

```
useRef                              useMemo í´ë¡œì €
â”€â”€â”€â”€â”€â”€â”€                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fiberì— ì €ì¥                        useMemo ì¸ìŠ¤í„´ìŠ¤ì— ë¡œì»¬
concurrent copies ê°„ ê³µìœ  âœ“         concurrent copies ê°„ ë…ë¦½ âœ“
ë Œë” ê°„ ê°’ ìœ ì§€ ëª©ì                 íŠ¹ì • ë©”ëª¨ ì¸ìŠ¤í„´ìŠ¤ ë‚´ ìºì‹œ ëª©ì 
```

---

### íŒ¨í„´ 7: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬

íŒ¨í„´ 2ì˜ Observerì™€ ê°™ì€ ì›ë¦¬ì´ì§€ë§Œ, ì¼ë°˜í™”í•˜ë©´:

```js
function MapComponent() {
  const mapContainerRef = useRef(null);   // DOM ì°¸ì¡°
  const mapInstanceRef = useRef(null);     // ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ìŠ¤í„´ìŠ¤

  useEffect(() => {
    // ë§ˆìš´íŠ¸: ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    mapInstanceRef.current = new MapLibrary(mapContainerRef.current, {
      center: [37.5, 127.0],
      zoom: 13,
    });

    // ì–¸ë§ˆìš´íŠ¸: ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
    return () => {
      mapInstanceRef.current.destroy();
      mapInstanceRef.current = null;
    };
  }, []);

  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œ í˜¸ì¶œ
  const handleZoomIn = () => {
    mapInstanceRef.current.setZoom(mapInstanceRef.current.getZoom() + 1);
  };
}
```

**ref 2ê°œì˜ ì—­í•  ë¶„ë¦¬**:

```
mapContainerRef  â†’ "ì–´ë””ì—" (DOM ì»¨í…Œì´ë„ˆ)
mapInstanceRef   â†’ "ë¬´ì—‡ì„" (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ìŠ¤í„´ìŠ¤)
```

ì´ê±´ íŒ¨í„´ 2ì—ì„œ ë³¸ `fragmentRef`(ëŒ€ìƒ) + `observerRef`(ê´€ì°°ì)ì™€ ë™ì¼í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.

---

## 7ê°€ì§€ íŒ¨í„´ ì´ì •ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  useRef ì‹¤ë¬´ íŒ¨í„´ ë§µ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ íŒ¨í„´         â”‚ refì— ì €ì¥í•˜ëŠ” ê²ƒ  â”‚ ì ‘ê·¼ ì‹œì               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. íƒ€ì´ë¨¸    â”‚ setTimeout ID    â”‚ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ + cleanup â”‚
â”‚ 2. Observer  â”‚ Observer ì¸ìŠ¤í„´ìŠ¤ â”‚ useEffect + cleanup   â”‚
â”‚ 3. ì´ì „ ê°’   â”‚ ì´ì „ ë Œë”ì˜ ê°’    â”‚ ë Œë” ì¤‘ (ì½ê¸°ë§Œ)       â”‚
â”‚ 4. ìµœì‹  ì½œë°± â”‚ ìµœì‹  í•¨ìˆ˜ ì°¸ì¡°    â”‚ í˜¸ì¶œ ì‹œì  (ì§€ì—° ì½ê¸°)   â”‚
â”‚ 5. DOM ì œì–´  â”‚ DOM ë…¸ë“œ         â”‚ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬          â”‚
â”‚ 6. Lazy init â”‚ ìºì‹œ ê°ì²´        â”‚ ë Œë” ì¤‘ (ë©±ë“± ì´ˆê¸°í™”)   â”‚
â”‚ 7. ì™¸ë¶€ lib  â”‚ lib ì¸ìŠ¤í„´ìŠ¤     â”‚ useEffect + í•¸ë“¤ëŸ¬     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê³µí†µì : ì „ë¶€ "ë Œë”ë§ì— í•„ìš” ì—†ì§€ë§Œ ê°’ì€ í•„ìš”í•œ ê²ƒ"
```

Phase 1ì—ì„œ 7ê°€ì§€ íŒ¨í„´ì„ íƒìƒ‰í–ˆìŠµë‹ˆë‹¤. Q&A 3íšŒ ë‹¬ì„±. `>>ë‹¤ìŒ`ìœ¼ë¡œ Phase 2(ì‹¬í™”)ë¡œ ë„˜ì–´ê°€ì‹œê² ì–´ìš”? ë˜ëŠ” ë” ê¶ê¸ˆí•œ íŒ¨í„´ì´ ìˆìœ¼ë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.

---

## [11:36:28] ì‚¬ìš©ì

ì¦‰ useMemo ì•ˆì˜ í´ë¡œì € ë³€ìˆ˜ëŠ” concurrent copyë§ˆë‹¤ ë…ë¦½ì ì´ì§€ë§Œ, useRefëŠ” Fiberì— ì €ì¥ë˜ë¯€ë¡œ ëª¨ë“  concurrent ë Œë”ê°€ ê°™ì€ refë¥¼
   ê³µìœ í•©ë‹ˆë‹¤. ìš©ë„ì— ë”°ë¼ refë¥¼ ì“¸ì§€, í´ë¡œì €ë¥¼ ì“¸ì§€ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤. << ë¬´ìŠ¨ë§ì¸ì§€ ì´í•´ê°€ ì•ˆê°‘ë‹ˆë‹¤

"concurrent copyë§ˆë‹¤" -> ì´ê²Œ ë­”ê°€ìš”? / ëª¨ë“  concurrent ë Œë”ê°€ ê°™ì€ refë¥¼ ê³µìœ  -> ê°™ì€ updateì¼ë•ŒëŠ” ê·¸ update ë²”ìœ„ì—ì„œ refê°€ ê°™ì€ ì°¸ì¡°ë¼ëŠ”ê±°ì£ ?

---

## [11:37:19] AI

> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 4 | ê²½ê³¼: 15ë¶„

ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤. "concurrent copy"ê°€ í•µì‹¬ì¸ë°, êµ¬ì²´ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

---

## "concurrent copy"ë€?

Concurrent Modeì—ì„œ ReactëŠ” **ê°™ì€ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ë¥¸ ìš°ì„ ìˆœìœ„ë¡œ ë™ì‹œì— ë Œë”**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
ì‚¬ìš©ìê°€ input íƒ€ì´í•‘ (ê¸´ê¸‰)  +  ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ transition (ë‚®ì€ ìš°ì„ ìˆœìœ„)
         â†“                              â†“
     ë Œë” ì‹œë„ A (ê¸´ê¸‰)            ë Œë” ì‹œë„ B (transition)
     ê°™ì€ <SearchPage />           ê°™ì€ <SearchPage />
```

ì´ ë‘ ë Œë” ì‹œë„ê°€ "concurrent copies"ì…ë‹ˆë‹¤. ê°™ì€ ì»´í¬ë„ŒíŠ¸ ì¸ìŠ¤í„´ìŠ¤ì˜ **ì„œë¡œ ë‹¤ë¥¸ ë Œë” ì‹œë„**.

---

## useRef: ë‘ ë Œë” ì‹œë„ê°€ ê°™ì€ refë¥¼ ë³¸ë‹¤

useRefëŠ” Fiberì— ì €ì¥ë©ë‹ˆë‹¤. ì»´í¬ë„ŒíŠ¸ ì¸ìŠ¤í„´ìŠ¤ë‹¹ FiberëŠ” 1ê°œì´ë¯€ë¡œ:

```
Fiber (SearchPage)
  â””â”€â”€ memoizedState
        â””â”€â”€ hook[0]: useRef â†’ { current: X }  â† í•˜ë‚˜ë¿

ë Œë” ì‹œë„ A (ê¸´ê¸‰):     ref.current ì½ê¸° â†’ X
  â”€â”€ Aê°€ ì¤‘ë‹¨ë¨, B ì‹œì‘ â”€â”€
ë Œë” ì‹œë„ B (transition): ref.current ì½ê¸° â†’ X  â† ê°™ì€ ê°ì²´
```

ë‘ ë²ˆì§¸ ì§ˆë¬¸ì— ëŒ€í•´ â€” "ê°™ì€ update ë²”ìœ„"ê°€ ì•„ë‹ˆë¼ **ëª¨ë“  ë Œë” ì‹œë„**ê°€ ê°™ì€ refë¥¼ ë´…ë‹ˆë‹¤. updateê°€ ë‹¤ë¥´ë“  ìš°ì„ ìˆœìœ„ê°€ ë‹¤ë¥´ë“  ìƒê´€ì—†ì´, ê°™ì€ ì»´í¬ë„ŒíŠ¸ ì¸ìŠ¤í„´ìŠ¤ë©´ ê°™ì€ refì…ë‹ˆë‹¤.

---

## useMemo í´ë¡œì €: ë Œë” ì‹œë„ë§ˆë‹¤ ë…ë¦½

```js
const [getSelection] = useMemo(() => {
  // ì´ ë³€ìˆ˜ë“¤ì€ ì´ useMemo ì‹¤í–‰ì˜ í´ë¡œì €ì— ê°‡í˜
  let hasMemo = false;
  let memoizedSnapshot;

  const memoizedSelector = (nextSnapshot) => {
    if (!hasMemo) { /* ... */ }
    // hasMemo, memoizedSnapshotì€ ì´ í´ë¡œì € ì•ˆì—ì„œë§Œ ì¡´ì¬
  };
  return [memoizedSelector];
}, [getSnapshot, selector]);
```

depsê°€ ë°”ë€Œë©´ useMemoê°€ **ìƒˆë¡œ ì‹¤í–‰**ë˜ê³ , **ìƒˆ í´ë¡œì €**ê°€ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤:

```
ë Œë” ì‹œë„ A: deps ë³€ê²½ â†’ useMemo ì‹¤í–‰ â†’ í´ë¡œì € A (hasMemo=false, ...)
  â”€â”€ Aê°€ íê¸°ë¨, B ì‹œì‘ â”€â”€
ë Œë” ì‹œë„ B: deps ë³€ê²½ â†’ useMemo ì‹¤í–‰ â†’ í´ë¡œì € B (hasMemo=false, ...)
                                         â†‘ Aì™€ ì™„ì „ ë…ë¦½!
```

---

## ì™œ ì´ê²Œ ë¬¸ì œì¸ê°€? â€” êµ¬ì²´ì  ì‹œë‚˜ë¦¬ì˜¤

ë§Œì•½ ì´ ì½”ë“œì—ì„œ í´ë¡œì € ëŒ€ì‹  useRefë¥¼ ì¼ë‹¤ë©´:

```js
// âœ— ê°€ìƒ: useRefë¡œ í–ˆì„ ë•Œ
const memoRef = useRef({ hasMemo: false, snapshot: null, selection: null });

const memoizedSelector = (nextSnapshot) => {
  if (!memoRef.current.hasMemo) {
    memoRef.current.hasMemo = true;
    memoRef.current.snapshot = nextSnapshot;
    // ...
  }
};
```

```
ë Œë” ì‹œë„ A: memoRef.current.hasMemo = true, snapshot = "ê²€ìƒ‰ì–´: ab"
  â”€â”€ Aê°€ íê¸°ë¨ (ë” ê¸´ê¸‰í•œ ì—…ë°ì´íŠ¸ ë•Œë¬¸ì—) â”€â”€
  â”€â”€ í•˜ì§€ë§Œ refëŠ” ì´ë¯¸ ì˜¤ì—¼ë¨! â”€â”€
ë Œë” ì‹œë„ B: memoRef.current.hasMemo = true  â† Aê°€ ë‚¨ê¸´ ì”ì¬!
             snapshot = "ê²€ìƒ‰ì–´: ab"          â† Bì˜ ë°ì´í„°ê°€ ì•„ë‹˜!
             â†’ ì˜ëª»ëœ ë¹„êµ â†’ ë²„ê·¸
```

**í´ë¡œì €ë¼ë©´**:

```
ë Œë” ì‹œë„ A: hasMemo = true (í´ë¡œì € A ì•ˆ)
  â”€â”€ Aê°€ íê¸°ë¨ â†’ í´ë¡œì € Aë„ GC â”€â”€
ë Œë” ì‹œë„ B: hasMemo = false (í´ë¡œì € B, ì™„ì „ ìƒˆë¡œìš´ ìƒíƒœ)
             â†’ ê¹¨ë—í•˜ê²Œ ì‹œì‘ âœ“
```

---

## ì •ë¦¬

| | useRef | useMemo í´ë¡œì € |
|---|---|---|
| ì €ì¥ ìœ„ì¹˜ | Fiber (ì»´í¬ë„ŒíŠ¸ ì¸ìŠ¤í„´ìŠ¤ì— 1ê°œ) | í•¨ìˆ˜ ìŠ¤ì½”í”„ (ì‹¤í–‰ë§ˆë‹¤ ìƒˆë¡œ ìƒì„±) |
| concurrent ë Œë” ê°„ | **ê³µìœ ** â€” í•œìª½ì´ ì˜¤ì—¼ì‹œí‚¤ë©´ ë‹¤ë¥¸ìª½ë„ ì˜í–¥ | **ë…ë¦½** â€” íê¸°ë˜ë©´ ì‚¬ë¼ì§ |
| ì í•©í•œ ìš©ë„ | ë Œë”ì™€ ë¬´ê´€í•˜ê²Œ ìœ ì§€í•  ê°’ (íƒ€ì´ë¨¸, DOM, ì½œë°±) | íŠ¹ì • ë Œë” ì‹œë„ì— ë¡œì»¬ì¸ ìºì‹œ |

ì§ˆë¬¸ ë” ìˆìœ¼ì‹ ê°€ìš”?

---

## [11:38:23] ì‚¬ìš©ì

ì´ê±´ ì´ì „ì— ë°°ì› ë˜ refëŠ” ë Œë”ì¤‘ ì½ê±°ë‚˜ ì“°ì§€ ë§ˆë¼ ë¼ëŠ” ê·œì¹™ê³¼ ì—°ê´€ëœê±°ê°™ë„¤ìš”

---

## [11:38:36] AI

> [ROUTINE] Phase 1/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 4 | ê²½ê³¼: 17ë¶„

ì •í™•í•©ë‹ˆë‹¤. ê°™ì€ ì›ì¹™ì˜ ë‹¤ë¥¸ í‘œë©´ì…ë‹ˆë‹¤.

```
"ë Œë” ì¤‘ ref ì½ê¸°/ì“°ê¸° ê¸ˆì§€"
         â”‚
         â”œâ”€â”€ í‘œë©´ 1: tearing (ì´ì „ í•™ìŠµ)
         â”‚   â†’ ê°™ì€ ë Œë” íŒ¨ìŠ¤ì—ì„œ Child1ì€ "A", Child2ëŠ” "B"
         â”‚
         â””â”€â”€ í‘œë©´ 2: concurrent copy ì˜¤ì—¼ (ì˜¤ëŠ˜ í•™ìŠµ)
             â†’ ë Œë” ì‹œë„ Aê°€ refì— ì“´ ê°’ì´ ë Œë” ì‹œë„ Bë¥¼ ì˜¤ì—¼
```

ê·¼ë³¸ ì›ì¸ì€ ë™ì¼í•©ë‹ˆë‹¤ â€” **ref.currentëŠ” mutableì´ê³ , Reactê°€ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ê°’**ì´ê¸° ë•Œë¬¸ì—, concurrent í™˜ê²½ì—ì„œ "ì–´ëŠ ë Œë”ê°€ ì–´ëŠ ê°’ì„ ë´ì•¼ í•˜ëŠ”ì§€" ë³´ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

`useSyncExternalStoreWithSelector`ì˜ React íŒ€ì´ useMemo í´ë¡œì €ë¥¼ ì„ íƒí•œ ê²ƒì€, ì´ ì›ì¹™ì„ ì •í™•íˆ ì´í•´í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë Œë” ì¤‘ ì‚¬ìš©í•  ìºì‹œ â†’ ref ëŒ€ì‹  í´ë¡œì €.

ì´ì „ í•™ìŠµì—ì„œ ë°°ìš´ ì›ì¹™ì´ ì‹¤ì „ ì½”ë“œì—ì„œ ì–´ë–»ê²Œ ì„¤ê³„ ê²°ì •ìœ¼ë¡œ ì´ì–´ì§€ëŠ”ì§€ ë³´ëŠ” ì¢‹ì€ ì˜ˆì…ë‹ˆë‹¤.

---

`>>ë‹¤ìŒ`ìœ¼ë¡œ Phase 2(ì‹¬í™”)ë¡œ ë„˜ì–´ê°ˆê¹Œìš”? ë˜ëŠ” ë” íƒìƒ‰í•  ê²ƒì´ ìˆìœ¼ë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.

---

## [11:39:01] ì‚¬ìš©ì

>>ë‹¤ìŒ

---

## [11:39:40] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:39:56] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:40:00] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_readLog

---

## [11:40:28] AI

> [ROUTINE] Phase 2/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 4 | ê²½ê³¼: 17ë¶„

## Phase 2: ì‹¬í™” â€” ì†ŒìŠ¤ì½”ë“œ ìˆ˜ì¤€ ì¶”ì 

Phase 1ì—ì„œ íƒìƒ‰í•œ 7ê°œ íŒ¨í„´ ì¤‘, ì†ŒìŠ¤ì½”ë“œë¡œ **ì„¤ê³„ ì˜ë„**ë¥¼ ë” ê¹Šì´ íŒŒë³¼ ìˆ˜ ìˆëŠ” 2ê°€ì§€ë¥¼ ì‹¬í™”í•©ë‹ˆë‹¤.

---

### ì‹¬í™” A: cleanup ìº¡ì²˜ íŒ¨í„´ â€” ì™œ Reactê°€ ìë™ìœ¼ë¡œ í•´ê²° ì•ˆ í•˜ëŠ”ê°€?

íŒ¨í„´ 2ì—ì„œ `const last = fragmentRef.current`ë¡œ ìº¡ì²˜í•´ì•¼ ì•ˆì „í•˜ë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì˜ë¬¸ì´ ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤ â€” Reactê°€ cleanupì— "ì´ì „ ref ê°’"ì„ ìë™ìœ¼ë¡œ ë„˜ê²¨ì£¼ë©´ ì•ˆ ë˜ë‚˜?

ì‹¤ì œë¡œ ReactëŠ” **effectì˜ deps ê°’**ì— ëŒ€í•´ì„œëŠ” ì´ê±¸ í•´ì¤ë‹ˆë‹¤:

```js
// depsê°€ ë°”ë€Œë©´ ì´ì „ effectë¥¼ ì •ë¦¬í•˜ê³  ìƒˆ effectë¥¼ ì‹¤í–‰
useEffect(() => {
  subscribe(channel);          // ìƒˆ channel êµ¬ë…
  return () => unsubscribe(channel);  // í´ë¡œì €ê°€ ì´ channelì„ ê¸°ì–µ
}, [channel]);
```

í•˜ì§€ë§Œ refëŠ” depsì— ë„£ì§€ ì•ŠìŠµë‹ˆë‹¤ â€” ref ìì²´ëŠ” ì•ˆì •ì  ì°¸ì¡°ì´ë‹ˆê¹Œìš”. ë¬¸ì œëŠ” `ref.current`ê°€ ë°”ë€ŒëŠ” ê²ƒì¸ë°, ì´ê±´ Reactì˜ ì˜ì¡´ì„± ì¶”ì  ë°”ê¹¥ì…ë‹ˆë‹¤.

```
deps ì¶”ì  ëŒ€ìƒ           deps ì¶”ì  ë°”ê¹¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
state                   ref.current
props                   ì™¸ë¶€ ë³€ìˆ˜
context                 DOM ìƒíƒœ
```

**Reactê°€ ref.current ë³€ê²½ì„ ì¶”ì í•˜ì§€ ì•ŠëŠ” ì´ìœ **: refì˜ ì¡´ì¬ ì´ìœ  ìì²´ê°€ "React ì‹œìŠ¤í…œ ë°”ê¹¥ì˜ mutable ê°’"ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì¶”ì í•˜ë©´ ê·¸ê±´ stateê°€ ë©ë‹ˆë‹¤.

---

### ì‹¬í™” B: usePreviousëŠ” ì™œ ê³µì‹ APIê°€ ì•„ë‹Œê°€?

ì´ê±´ React íŒ€ì˜ ì˜ë„ì  ê²°ì •ì…ë‹ˆë‹¤. `usePrevious`ëŠ” í”í•œ íŒ¨í„´ì´ì§€ë§Œ ê³µì‹ í›…ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ìœ ë¥¼ ì†ŒìŠ¤ì½”ë“œì—ì„œ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. React Compilerì˜ ê´€ì ì„ ë³´ë©´:

`ref/react/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.js`

```
React CompilerëŠ” ref.current ì ‘ê·¼ì„ "ë¶€ìˆ˜íš¨ê³¼"ë¡œ ë¶„ë¥˜
â†’ ìë™ ë©”ëª¨ì´ì œì´ì…˜ì—ì„œ ì œì™¸
â†’ usePreviousë¥¼ ê³µì‹ APIë¡œ ë§Œë“¤ë©´, "ë Œë” ì¤‘ ref ì½ê¸°"ë¥¼ ê³µì‹ ê¶Œì¥í•˜ëŠ” ì…ˆ
â†’ Compilerì˜ ìµœì í™” ì „ëµê³¼ ì¶©ëŒ
```

React íŒ€ì´ ëŒ€ì‹  ê¶Œì¥í•˜ëŠ” ë°©í–¥:

```js
// usePrevious ëŒ€ì‹  â€” stateì—ì„œ ì§ì ‘ íŒŒìƒ
const [prevCount, setPrevCount] = useState(count);
if (count !== prevCount) {
  setPrevCount(count);
  // ì—¬ê¸°ì„œ "ì´ì „ ê°’"ê³¼ "í˜„ì¬ ê°’" ë¹„êµ ê°€ëŠ¥
}
```

ì´ íŒ¨í„´ì€ ë Œë” ì¤‘ `setState`ë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ, Reactê°€ ê³µì‹ì ìœ¼ë¡œ í—ˆìš©í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤ â€” í˜„ì¬ ë Œë”ë¥¼ ì¤‘ë‹¨í•˜ê³  ìƒˆ stateë¡œ ì¦‰ì‹œ ì¬ë Œë”í•©ë‹ˆë‹¤.

---

### Q&A

ì´ ë‘ ì‹¬í™” í¬ì¸íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§ˆë¬¸ ë“œë¦½ë‹ˆë‹¤.

**Q1**: íŒ¨í„´ 2(Observer)ì—ì„œ cleanup ìº¡ì²˜ë¥¼ ì•ˆ í•˜ë©´ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë²„ê·¸ê°€ ë‚ ê¹Œìš”?

```js
useEffect(() => {
  const observer = new ResizeObserver(callback);
  ref.current.observe(observer);

  // ìº¡ì²˜ ì—†ì´ ì§ì ‘ ì‚¬ìš©
  return () => {
    ref.current.unobserve(observer);  // â† ì–´ë–¤ ìƒí™©ì—ì„œ ë¬¸ì œ?
  };
}, []);
```

ì–´ë–¤ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì´ cleanupì´ ì˜ë„ëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ì§€ ì„¤ëª…í•´ë³´ì„¸ìš”.

---

## [11:43:01] ì‚¬ìš©ì

ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•˜ëŠ” ìƒí™© -> ì´ì „ì—ëŠ” <div#A> ì°¸ì¡° ì¤‘ì´ì˜€ìŒ -> cleanupë„ <div#A> í´ë¦°ì—… ê¸°ëŒ€ -> ë¦¬ë Œë”ë§ -> ë¦¬ìŠ¤íŠ¸ í•˜ë‚˜ ì¶”ê°€ë¨ <div#B>ë¥¼ í´ë¦°ì—…í•˜ê²Œë¨

---

## [11:43:20] AI

> [ROUTINE] Phase 2/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 5 | ê²½ê³¼: 19ë¶„

ë°©í–¥ì€ ë§ìŠµë‹ˆë‹¤. í•œ ê°€ì§€ ë³´ì™„í•˜ë©´ â€” ì´ ì˜ˆì‹œì—ì„œ `ref`ëŠ” ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œì´ ì•„ë‹ˆë¼ **Fragment ref**ì´ë¯€ë¡œ, ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ì¶”ê°€ë³´ë‹¤ëŠ” **ì¡°ê±´ë¶€ ë Œë”ë§**ì´ ë” í˜„ì‹¤ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤.

```jsx
function App() {
  const ref = useRef(null);
  const [showA, setShowA] = useState(true);

  useEffect(() => {
    const observer = new ResizeObserver(callback);
    ref.current.observe(observer);
    return () => {
      ref.current.unobserve(observer);  // â† ìœ„í—˜
    };
  }, []);

  return showA ? <div ref={ref}>A</div> : <div ref={ref}>B</div>;
}
```

```
â‘  ë§ˆìš´íŠ¸: ref.current = <div>A</div>
   effect ì‹¤í–‰: observe(<div>A)

â‘¡ setShowA(false) â†’ ë¦¬ë Œë”
   React ì»¤ë°‹: ref.current = <div>B</div>  â† ìƒˆ DOMìœ¼ë¡œ ê°±ì‹ 
   ì´ì „ effect cleanup ì‹¤í–‰:
     ref.current.unobserve(observer)
     â†’ <div>B</div>.unobserve()  â† Bë¥¼ unobserve!
     â†’ <div>A</div>ëŠ” ì •ë¦¬ ì•ˆ ë¨! â† ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
```

ê·¸ëŸ°ë° ì‚¬ì‹¤ `deps: []`ì´ë©´ cleanupì€ **ì–¸ë§ˆìš´íŠ¸ ì‹œì—ë§Œ** ì‹¤í–‰ë˜ë¯€ë¡œ ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì¢€ ì–µì§€ì…ë‹ˆë‹¤. ë” í˜„ì‹¤ì ì¸ ë¬¸ì œëŠ”:

```
â‘¢ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ:
   ref.current = null  â† Reactê°€ ì–¸ë§ˆìš´íŠ¸ ì‹œ refë¥¼ nullë¡œ ì„¤ì •
   cleanup: ref.current.unobserve(observer)
   â†’ null.unobserve() â†’ TypeError! ğŸ’¥
```

**ì´ê²Œ ê°€ì¥ í”í•œ ì‹¤ì œ ë²„ê·¸ì…ë‹ˆë‹¤.** ì–¸ë§ˆìš´íŠ¸ ì‹œ ref.currentê°€ nullì´ ë˜ì–´ ëŸ°íƒ€ì„ ì—ëŸ¬.

```js
// ìº¡ì²˜í•˜ë©´:
const node = ref.current;        // <div>A</div> ê³ ì •
return () => {
  node.unobserve(observer);      // ì–¸ë§ˆìš´íŠ¸ ì‹œì—ë„ <div>A</div> ì°¸ì¡° ìœ ì§€ âœ“
};
```

ì •ë¦¬í•˜ë©´ ìº¡ì²˜ê°€ ë°©ì–´í•˜ëŠ” ë¬¸ì œëŠ” ë‘ ê°€ì§€ì…ë‹ˆë‹¤:

| ì‹œë‚˜ë¦¬ì˜¤ | ìº¡ì²˜ ì—†ì´ | ìº¡ì²˜ ìˆìœ¼ë©´ |
|---------|----------|-----------|
| DOMì´ ë°”ë€œ | ì˜ëª»ëœ DOMì„ ì •ë¦¬ | ì›ë˜ DOMì„ ì •ë¦¬ |
| ì–¸ë§ˆìš´íŠ¸ | `null.method()` â†’ TypeError | ìº¡ì²˜ëœ DOMìœ¼ë¡œ ì •ë¦¬ |

---

**Q2**: Phase 1ì—ì„œ React íŒ€ì´ `useSyncExternalStoreWithSelector`ì—ì„œ useRef ëŒ€ì‹  useMemo í´ë¡œì €ë¥¼ ì„ íƒí•œ ì´ìœ ë¥¼ ë°°ì› ìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ â€” **usePrevious íŒ¨í„´ë„ ê°™ì€ ë¬¸ì œ(concurrent copy ì˜¤ì—¼)ì— ë…¸ì¶œë ê¹Œìš”?** ë Œë” ì¤‘ì— ref.currentë¥¼ ì½ìœ¼ë‹ˆê¹Œìš”.

---

## [11:47:39] ì‚¬ìš©ì

const usePrevious = (value) => {
  const ref = useRef()
  useEffect(() => {
    ref.current = value
  })
  return ref.current
}

ì´ê²ƒì— ëŒ€í•œ ë‹µì€ "ë Œë” ì‹œë„"ê°€ ì‹¤ì œ ë Œë”ì— ì˜í–¥ì„ ì£¼ëƒ ì¼ê±°ê°™ìŠµë‹ˆë‹¤ í•´ë‹¹ ì»¤ìŠ¤í…€ í›…ì—ì„œ ref.current ë³€ê²½ì€ useEffectì•ˆ (ë Œë” í›„)ì— ì¼ì–´ë‚˜ë¯€ë¡œ ë Œë” ì‹œë„ê°€ ë Œë” í›„ë‘ ì˜í–¥ì´ ì—†ë‹¤ë©´, ì´ê±´ ìœ„ useMemo ë¬¸ì œ ì¼€ì´ìŠ¤ë‘ ë‹¤ë¥¼ê±°ê°™ìŠµë‹ˆë‹¤

---

## [11:48:00] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:48:16] AI

> [ROUTINE] Phase 2/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 21ë¶„

ì •í™•í•©ë‹ˆë‹¤. í•µì‹¬ì„ ì˜ ì§šì—ˆìŠµë‹ˆë‹¤.

```
useSyncExternalStoreWithSelector          usePrevious
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
useMemo ì•ˆì—ì„œ refì— ì“°ê¸°              useEffect ì•ˆì—ì„œ refì— ì“°ê¸°
  â†’ ë Œë” ì¤‘ ì‹¤í–‰                        â†’ ì»¤ë°‹ í›„ ì‹¤í–‰
  â†’ ë Œë” ì‹œë„ Aê°€ ì“´ ê°’ì´               â†’ ë Œë” ì‹œë„ê°€ íê¸°ë˜ë©´
    ë Œë” ì‹œë„ Bì— ë³´ì„                     useEffect ìì²´ê°€ ì‹¤í–‰ ì•ˆ ë¨
  â†’ ì˜¤ì—¼ âœ—                              â†’ ì˜¤ì—¼ ì—†ìŒ âœ“
```

**ë Œë” ì‹œë„ê°€ íê¸°ë˜ë©´ useEffectëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.** useEffectëŠ” ì»¤ë°‹ëœ ë Œë”ì— ëŒ€í•´ì„œë§Œ ì‹¤í–‰ë˜ë‹ˆê¹Œìš”.

```
ë Œë” ì‹œë„ A (íê¸°ë¨):
  â‘  return ref.current â†’ ì´ì „ ê°’ ì½ê¸° (ì½ê¸°ë§Œ, ì“°ê¸° ì—†ìŒ)
  â‘¡ useEffect ë“±ë¡ë§Œ ë¨ â†’ ì»¤ë°‹ ì•ˆ ë¨ â†’ effect ì‹¤í–‰ ì•ˆ ë¨
  â†’ ref.current ë³€ê²½ ì—†ìŒ âœ“

ë Œë” ì‹œë„ B (ì»¤ë°‹ë¨):
  â‘  return ref.current â†’ ê°™ì€ ì´ì „ ê°’ ì½ê¸° (Aê°€ ì˜¤ì—¼ ì•ˆ í–ˆìœ¼ë¯€ë¡œ)
  â‘¡ useEffect ì‹¤í–‰ â†’ ref.current = value
```

ê·¸ë˜ì„œ usePreviousëŠ” concurrent copy ì˜¤ì—¼ ë¬¸ì œëŠ” ì—†ìŠµë‹ˆë‹¤. **ì½ê¸°ë§Œ ë Œë” ì¤‘ì— í•˜ê³ , ì“°ê¸°ëŠ” effectì—ì„œ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

ë‹¤ë§Œ ì•„ê¹Œ ë§í–ˆë“¯ì´ React íŒ€ì´ usePreviousë¥¼ ê³µì‹ APIë¡œ ì•ˆ ë§Œë“œëŠ” ì´ìœ ëŠ” â€” React Compilerê°€ ë Œë” ì¤‘ `ref.current` ì½ê¸°ë¥¼ ë¶€ìˆ˜íš¨ê³¼ë¡œ ë¶„ë¥˜í•˜ë¯€ë¡œ ìë™ ë©”ëª¨ì´ì œì´ì…˜ ìµœì í™”ê°€ ì œí•œë©ë‹ˆë‹¤. ë™ì‘ì€ í•˜ì§€ë§Œ "ê¶Œì¥"í•˜ê¸°ì—” ìµœì í™”ì™€ ì¶©ëŒí•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

---

`>>ë‹¤ìŒ`ìœ¼ë¡œ Phase 3(ë¼ì´ë¸Œ ì½”ë”©)ìœ¼ë¡œ ë„˜ì–´ê°ˆê¹Œìš”? ë˜ëŠ” ë” ì‹¬í™”í•  ë¶€ë¶„ì´ ìˆìœ¼ë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.

---

## [11:48:28] ì‚¬ìš©ì

>>ë”°ìŒ

---

## [11:48:50] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:49:00] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:49:13] AI

> [ROUTINE] Phase 3/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 22ë¶„

## Phase 3: ë¼ì´ë¸Œ ì½”ë”©

ì˜¤ëŠ˜ í•™ìŠµí•œ íŒ¨í„´ë“¤ì„ ì¢…í•©í•˜ëŠ” ê³¼ì œë¥¼ ì¶œì œí•©ë‹ˆë‹¤.

---

### ê³¼ì œ

- **ìœ í˜•**: êµ¬í˜„
- **ì„¤ëª…**: `useDebounce` ì»¤ìŠ¤í…€ í›…ì„ êµ¬í˜„í•˜ì„¸ìš”. ì…ë ¥ê°’ì´ ë³€ê²½ëœ í›„ ì§€ì •ëœ ì§€ì—° ì‹œê°„ì´ ì§€ë‚˜ì•¼ ë””ë°”ìš´ìŠ¤ëœ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

**ìš”êµ¬ì‚¬í•­**:
1. `useDebounce(value, delay)` ì‹œê·¸ë‹ˆì²˜
2. ë””ë°”ìš´ìŠ¤ëœ ê°’ì„ ë°˜í™˜ (delay ms ë™ì•ˆ valueê°€ ì•ˆ ë°”ë€Œë©´ ê·¸ë•Œ ë°˜ì˜)
3. ì–¸ë§ˆìš´íŠ¸ ì‹œ íƒ€ì´ë¨¸ ì •ë¦¬
4. íƒ€ì´ë¨¸ IDëŠ” refë¡œ ê´€ë¦¬

**ì‚¬ìš© ì˜ˆì‹œ**:
```jsx
function SearchPage() {
  const [query, setQuery] = useState("");
  const debouncedQuery = useDebounce(query, 300);

  useEffect(() => {
    if (debouncedQuery) fetchResults(debouncedQuery);
  }, [debouncedQuery]);

  return <input onChange={e => setQuery(e.target.value)} />;
}
```

<details>
<summary>íŒíŠ¸ (í•„ìš”í•˜ë©´ í¼ì¹˜ì„¸ìš”)</summary>

ì˜¤ëŠ˜ ë°°ìš´ íŒ¨í„´ 1(íƒ€ì´ë¨¸ ê´€ë¦¬)ê³¼ íŒ¨í„´ 3(ì´ì „ ê°’)ì˜ ì¡°í•©ì…ë‹ˆë‹¤. ë””ë°”ìš´ìŠ¤ëœ ê°’ì€ í™”ë©´ì— ë°˜ì˜ë˜ì–´ì•¼ í•˜ë¯€ë¡œ â€” ì´ê±´ refê°€ ì•„ë‹ˆë¼ ë¬´ì—‡ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼ í• ê¹Œìš”?

</details>

---

ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

---

## [11:52:46] ì‚¬ìš©ì

  function useDebounce(callback, ms) {
    const timeoutID = useRef(-1);           
    useEffect(() => {
      return function unmount() {
        clearTimeout(timeoutID.current);    
      };
    }, []);
    const debouncedCallback = useCallback(
      (...args) => {
        clearTimeout(timeoutID.current);    
        timeoutID.current = setTimeout(callback, ms, ...args);  
      },
      [callback, ms],
    );
    return debouncedCallback;
  }

---

## [11:52:57] AI

> [ROUTINE] Phase 3/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 24ë¶„

### 1ì°¨ ë¦¬ë·°

ê³¼ì œì™€ êµ¬í˜„ì´ ë‹¤ë¦…ë‹ˆë‹¤. ì‘ì„±í•˜ì‹  ì½”ë“œë¥¼ ë³´ë©´:

**ì‘ì„±í•œ ê²ƒ**: `useDebounce(callback, ms)` â†’ ë””ë°”ìš´ìŠ¤ëœ **í•¨ìˆ˜** ë°˜í™˜
**ê³¼ì œê°€ ìš”êµ¬í•œ ê²ƒ**: `useDebounce(value, delay)` â†’ ë””ë°”ìš´ìŠ¤ëœ **ê°’** ë°˜í™˜

```
ê³¼ì œì˜ ì‚¬ìš© ì˜ˆì‹œ:
  const debouncedQuery = useDebounce(query, 300);
  //    â†‘ string ê°’                   â†‘ ê°’

ì‘ì„±í•œ ì½”ë“œì˜ ì‚¬ìš©ë²•:
  const debouncedFn = useDebounce(fetchResults, 300);
  //    â†‘ í•¨ìˆ˜                        â†‘ ì½œë°±
```

ì‘ì„±í•œ ì½”ë“œ ìì²´ëŠ” Phase 1ì—ì„œ ë³¸ `useDebouncedCallback` íŒ¨í„´ê³¼ ë™ì¼í•˜ê³ , ê·¸ ìì²´ë¡œ ì˜ ë™ì‘í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ê³¼ì œëŠ” **ê°’ì„ ë””ë°”ìš´ìŠ¤**í•˜ëŠ” í›…ì…ë‹ˆë‹¤.

í•µì‹¬ ì°¨ì´:
- ë””ë°”ìš´ìŠ¤ëœ **ê°’**ì€ í™”ë©´ì— ë³´ì—¬ì•¼ í•¨ â†’ `useState` í•„ìš”
- ë””ë°”ìš´ìŠ¤ëœ **í•¨ìˆ˜**ëŠ” ì‹¤í–‰ë§Œ ì§€ì—° â†’ `useRef`ë§Œìœ¼ë¡œ ì¶©ë¶„

---

ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ ì œì¶œí•˜ì‹œê² ì–´ìš”? ì•„ë‹ˆë©´ ëª¨ë²” ë‹µì•ˆì„ ë°”ë¡œ ë³¼ê¹Œìš”?

---

## [11:56:06] ì‚¬ìš©ì

  function useDebounce(value, delay) {
    const [debouncedValue, setDebouncedValue] = useState(value)
    const timeoutID = useRef(-1);           
    useEffect(() => {
      return function unmount() {
        clearTimeout(timeoutID.current);    
      };
    }, []);
    useCallback(
      (...args) => {
        clearTimeout(timeoutID.current);    
        timeoutID.current = setTimeout(() => setDebouncedValue(value), delay, ...args);  
      },
      [value, delay],
    );
    return debouncedValue;
  }

---

## [11:56:26] AI

> [ROUTINE] Phase 3/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 26ë¶„

### 2ì°¨ ë¦¬ë·° (ëª¨ë²” ë‹µì•ˆ ê³µê°œ)

`useState` + `useRef` ì¡°í•©ì€ ë§ìŠµë‹ˆë‹¤. ë¬¸ì œëŠ” **íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•˜ëŠ” íŠ¸ë¦¬ê±°**ì…ë‹ˆë‹¤.

`useCallback`ì€ í•¨ìˆ˜ë¥¼ **ë§Œë“¤ê¸°ë§Œ** í•©ë‹ˆë‹¤ â€” ëˆ„êµ°ê°€ í˜¸ì¶œí•´ì•¼ ì‹¤í–‰ë©ë‹ˆë‹¤. ì‘ì„±í•œ ì½”ë“œì—ì„œëŠ” ë§Œë“¤ì–´ë§Œ ë†“ê³  ì•„ë¬´ë„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ íƒ€ì´ë¨¸ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

valueê°€ ë°”ë€” ë•Œ **ìë™ìœ¼ë¡œ** íƒ€ì´ë¨¸ë¥¼ ê±¸ì–´ì•¼ í•˜ë¯€ë¡œ â†’ `useEffect`ê°€ ë§ìŠµë‹ˆë‹¤.

---

### ëª¨ë²” ë‹µì•ˆ

```js
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);
  const timeoutID = useRef(-1);

  useEffect(() => {
    clearTimeout(timeoutID.current);
    timeoutID.current = setTimeout(() => setDebouncedValue(value), delay);

    return () => {
      clearTimeout(timeoutID.current);
    };
  }, [value, delay]);

  return debouncedValue;
}
```

### ì°¨ì´ì  ë¶„ì„

| | ì‘ì„±í•œ ì½”ë“œ | ëª¨ë²” ë‹µì•ˆ |
|---|---|---|
| íƒ€ì´ë¨¸ ì‹œì‘ | `useCallback` (í˜¸ì¶œ ì•ˆ ë¨) | `useEffect` (value ë³€ê²½ ì‹œ ìë™ ì‹¤í–‰) |
| cleanup | ë³„ë„ `useEffect([], unmount)` | deps ë³€ê²½ë§ˆë‹¤ ì´ì „ íƒ€ì´ë¨¸ ì •ë¦¬ |
| íƒ€ì´ë¨¸ ì •ë¦¬ ì‹œì  | ì–¸ë§ˆìš´íŠ¸ ì‹œì—ë§Œ | **ë§¤ value ë³€ê²½ë§ˆë‹¤** + ì–¸ë§ˆìš´íŠ¸ ì‹œ |

í•µì‹¬ ì°¨ì´ëŠ” cleanup ì‹œì ì…ë‹ˆë‹¤:

```
ì‘ì„±í•œ ì½”ë“œ: cleanupì´ ì–¸ë§ˆìš´íŠ¸ ì‹œì—ë§Œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
value="a" â†’ íƒ€ì´ë¨¸ ì‹œì‘ (300ms)
value="ab" â†’ íƒ€ì´ë¨¸ ì‹œì‘ (300ms)  â† ì´ì „ íƒ€ì´ë¨¸ ì•ˆ ì§€ì›Œì§!
â†’ 300ms í›„: setDebouncedValue("a") ì‹¤í–‰ (ì˜ë„í•˜ì§€ ì•Šì€ ê°’)
â†’ 300ms í›„: setDebouncedValue("ab") ì‹¤í–‰

ëª¨ë²” ë‹µì•ˆ: cleanupì´ ë§¤ deps ë³€ê²½ë§ˆë‹¤
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
value="a" â†’ íƒ€ì´ë¨¸ ì‹œì‘ (300ms)
value="ab" â†’ ì´ì „ íƒ€ì´ë¨¸ clearTimeout â†’ ìƒˆ íƒ€ì´ë¨¸ ì‹œì‘ (300ms)
â†’ 300ms í›„: setDebouncedValue("ab")ë§Œ ì‹¤í–‰ âœ“
```

useEffectì˜ cleanupì€ **ë‹¤ìŒ effect ì‹¤í–‰ ì „**ì— í˜¸ì¶œë©ë‹ˆë‹¤. `[value, delay]`ë¥¼ depsë¡œ ë„£ìœ¼ë©´, valueê°€ ë°”ë€” ë•Œë§ˆë‹¤ ì´ì „ íƒ€ì´ë¨¸ë¥¼ ì •ë¦¬í•˜ê³  ìƒˆ íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì´ê²Œ ë””ë°”ìš´ìŠ¤ì˜ í•µì‹¬ â€” "ì´ì „ ê²ƒ ì·¨ì†Œ, ìƒˆë¡œ ì‹œì‘"ì…ë‹ˆë‹¤.

### í•™ìŠµ í¬ì¸íŠ¸

```
useCallback â†’ í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤ (ìˆ˜ë™ í˜¸ì¶œ í•„ìš”)
useEffect   â†’ ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì‹¤í–‰í•œë‹¤ (deps ë³€ê²½ ì‹œ ìë™)
                                   â†‘ value ë³€ê²½ì— ë°˜ì‘í•´ì•¼ í•˜ë¯€ë¡œ ì´ìª½
```

---

`>>ë‹¤ìŒ`ìœ¼ë¡œ Phase 4(ì²´í¬í¬ì¸íŠ¸)ë¡œ ë„˜ì–´ê°€ì‹œê² ì–´ìš”?

---

## [11:57:09] ì‚¬ìš©ì

>>ë‹¤ìŒ

---

## [11:57:20] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:57:24] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [11:57:30] AI

> [ROUTINE] Phase 4/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 30ë¶„

## ì²´í¬í¬ì¸íŠ¸

ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ê²€ì¦í•©ë‹ˆë‹¤. ì½”ë“œë¥¼ ë³´ì§€ ì•Šê³  ë‹µí•´ì£¼ì„¸ìš”.

---

### Q1: "ì´ê²Œ ì™œ ì´ë ‡ê²Œ ë™ì‘í•´?"

Observer íŒ¨í„´(ResizeObserver ë“±)ì˜ cleanupì—ì„œ `ref.current`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³  `const last = ref.current`ë¡œ ìº¡ì²˜í•˜ëŠ” ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”. ìº¡ì²˜í•˜ì§€ ì•Šìœ¼ë©´ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí•˜ë‚˜ìš”?

---

## [11:58:28] ì‚¬ìš©ì

ìº¡ì³í•˜ì§€ ì•Šìœ¼ë©´ ë™ì‹œ ë Œë”ë§ì—ì„œ ë Œë” íê¸°ëœ ë Œë”ì—ì„œ ref.currentê°€ ì˜¤ì—¼ë˜ì—ˆì„ìˆ˜ìˆê³ , refëŠ” Fiberë‚´ ì°¸ì¡°ê°€ ê³µìœ ë˜ë¯€ë¡œ ì˜¤ì—¼ëœ ê°’ì„ ì°¸ì¡°í•  ìœ„í—˜ ì¡´ì¬ 

---

## [11:58:42] AI

> [ROUTINE] Phase 4/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 32ë¶„

í¥ë¯¸ë¡œìš´ ë‹µë³€ì…ë‹ˆë‹¤. concurrent ì˜¤ì—¼ ê°œë…ì„ ì ìš©í•˜ì…¨ëŠ”ë°, ì´ ê²½ìš°ëŠ” ì¡°ê¸ˆ ë‹¤ë¦…ë‹ˆë‹¤.

**cleanup ìº¡ì²˜ íŒ¨í„´ì˜ ì£¼ëœ ì´ìœ ëŠ” concurrent ë Œë” ì˜¤ì—¼ì´ ì•„ë‹™ë‹ˆë‹¤.** cleanupì€ **ì»¤ë°‹ í›„**ì— ì‹¤í–‰ë˜ë¯€ë¡œ ë Œë” ì¤‘ ë¬¸ì œê°€ ì•„ë‹™ë‹ˆë‹¤.

ì‹¤ì œ ì´ìœ ëŠ” ë” ë‹¨ìˆœí•©ë‹ˆë‹¤:

1. **cleanup ì‹¤í–‰ ì‹œì ì— ref.currentê°€ ì´ë¯¸ ê°±ì‹ ë¨** â€” Reactê°€ ìƒˆ DOMì„ ì»¤ë°‹í•˜ë©´ì„œ ref.currentë¥¼ ìƒˆ ê°’ìœ¼ë¡œ ë°”ê¾¸ê³ , ê·¸ í›„ì— ì´ì „ effect cleanupì„ ì‹¤í–‰. ê·¸ë˜ì„œ cleanupì´ ì´ì „ DOMì´ ì•„ë‹Œ ìƒˆ DOMì„ ì •ë¦¬í•˜ê²Œ ë¨.
2. **ì–¸ë§ˆìš´íŠ¸ ì‹œ ref.current = null** â€” `null.unobserve()` â†’ TypeError

ì˜¤ëŠ˜ ë°°ìš´ concurrent copy ì˜¤ì—¼ì€ **ë Œë” ì¤‘ ref ì½ê¸°/ì“°ê¸°**ì— í•´ë‹¹í•˜ê³ , cleanup ìº¡ì²˜ëŠ” **ì»¤ë°‹ í›„ íƒ€ì´ë° ë¬¸ì œ**ì…ë‹ˆë‹¤. ê´€ë ¨ì€ ìˆì§€ë§Œ ë©”ì»¤ë‹ˆì¦˜ì´ ë‹¤ë¦…ë‹ˆë‹¤.

---

### Q2: "ë‚˜ë¼ë©´ ì–´ë–»ê²Œ ë§Œë“¤ì—ˆì„ê¹Œ?"

React íŒ€ì€ `usePrevious`ë¥¼ ê³µì‹ APIë¡œ ë§Œë“¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë§Œì•½ ë‹¹ì‹ ì´ React íŒ€ì´ë¼ë©´, "ì´ì „ ê°’ ì¶”ì " ê¸°ëŠ¥ì„ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì œê³µí•˜ê² ìŠµë‹ˆê¹Œ? useRef ê¸°ë°˜ usePreviousì˜ í•œê³„ë¥¼ ê³ ë ¤í•´ì„œ ë‹µí•´ì£¼ì„¸ìš”.

---

## [11:59:21] ì‚¬ìš©ì

ì•„ë‹ˆìš” ReactíŒ€ì´ ì œê³µ ì•ˆí•˜ëŠ” ì´ìœ ì— ê³µê°í•©ë‹ˆë‹¤

---

## [11:59:26] AI

> [ROUTINE] Phase 4/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 34ë¶„

ì¢‹ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ â€” ì™œ ê³µê°í•˜ëŠ”ì§€, ì œê³µí•˜ì§€ ì•ŠëŠ” ì´ìœ ê°€ ë­”ì§€ ì„¤ëª…í•´ì£¼ì‹œê² ì–´ìš”?

---

## [12:00:01] ì‚¬ìš©ì

usePreviousëŠ” ì´ì „ê°’ì„ ì €ì¥í•˜ê³  ë³´í†µ ê·¸ ì´ì „ê°’ì€ ë Œë”ë§ì— ì‚¬ìš©ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ refëŠ” ë Œë”ë§ì— ê´€ì—¬ë˜ì§€ ì•ŠëŠ” ê°’ì„ ìœ„í•œ í›…ì…ë‹ˆë‹¤

---

## [12:00:15] AI

> [ROUTINE] Phase 4/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 35ë¶„

### í”¼ë“œë°±

**ì˜ ë‹µí•œ ë¶€ë¶„**: useRefì˜ ì„¤ê³„ ì˜ë„("ë Œë”ë§ì— ê´€ì—¬ë˜ì§€ ì•ŠëŠ” ê°’")ì™€ usePreviousì˜ ì‹¤ì œ ì‚¬ìš©("ë Œë”ë§ì— ì‚¬ìš©")ì˜ ëª¨ìˆœì„ ì •í™•íˆ ì§šì—ˆìŠµë‹ˆë‹¤. í•µì‹¬ ì² í•™ì  ì´ìœ ë¡œ ë§ìŠµë‹ˆë‹¤.

**ë³´ì¶©í•  ë¶€ë¶„**: ê¸°ìˆ ì  ì´ìœ ê°€ í•˜ë‚˜ ë” ìˆìŠµë‹ˆë‹¤ â€” React Compilerê°€ ë Œë” ì¤‘ `ref.current` ì½ê¸°ë¥¼ ë¶€ìˆ˜íš¨ê³¼ë¡œ ë¶„ë¥˜í•˜ë¯€ë¡œ, usePreviousë¥¼ ê³µì‹ APIë¡œ ë§Œë“¤ë©´ ìë™ ë©”ëª¨ì´ì œì´ì…˜ ìµœì í™”ê°€ ì œí•œë©ë‹ˆë‹¤. React íŒ€ì´ ëŒ€ì‹  ê¶Œì¥í•˜ëŠ” ë°©í–¥ì€ stateì—ì„œ ì§ì ‘ íŒŒìƒí•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤:

```js
const [prevCount, setPrevCount] = useState(count);
if (count !== prevCount) {
  setPrevCount(count);
  // ì—¬ê¸°ì„œ ì´ì „ ê°’ê³¼ í˜„ì¬ ê°’ ë¹„êµ ê°€ëŠ¥
}
```

---

### ìê¸° í‰ê°€

```
ìê¸° í‰ê°€ë¥¼ í•´ì£¼ì„¸ìš”:
- PASS â†’ í•µì‹¬ ê°œë…ì„ reviewì— ë“±ë¡í•˜ê³  ì •ë¦¬í•©ë‹ˆë‹¤ (Phase 5)
- FAIL â†’ gapì„ ê¸°ë¡í•˜ê³  ë‹¤ìŒ ì ‘ê·¼ ë°©ì‹ì„ ì œì•ˆí•©ë‹ˆë‹¤ (Phase 5)

FAILì€ "ë‚˜ëŠ” ì •í™•íˆ ì—¬ê¸°ì„œ ëª¨ë¥¸ë‹¤"ë¥¼ ì•„ëŠ” ê²ƒì…ë‹ˆë‹¤. ë¶€ì •ì ì¸ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.
```

---

## [12:00:24] ì‚¬ìš©ì

PASS

---

## [12:00:34] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__routine_appendEntry

---

## [12:00:44] AI

> [ROUTINE] Phase 4/5 | useRef ì‹¤ë¬´ íŒ¨í„´ | Q&A: 6 | ê²½ê³¼: 36ë¶„

PASSì…ë‹ˆë‹¤. ì´ë²ˆ ì„¸ì…˜ì—ì„œ ë‹¤ë£¬ í•µì‹¬ ê°œë…ì„ reviewì— ë“±ë¡í•˜ê² ìŠµë‹ˆë‹¤.

### review ë“±ë¡ ê°œë… (5ê°œ)

| # | ê°œë… | ì„¤ëª… |
|---|------|------|
| 1 | sentinel ê°’ íŒ¨í„´ (-1) | íƒ€ì´ë¨¸ ref ì´ˆê¸°ê°’ìœ¼ë¡œ -1 ì‚¬ìš©, clearTimeout ì•ˆì „ì„±ê³¼ íƒ€ì… ì¼ê´€ì„± |
| 2 | cleanup ìº¡ì²˜ íŒ¨í„´ | effect cleanupì—ì„œ ref.current ì§ì ‘ ì‚¬ìš© ê¸ˆì§€, ë¡œì»¬ ë³€ìˆ˜ë¡œ ìº¡ì²˜ |
| 3 | usePrevious íƒ€ì´ë° | ë Œë” ì‹œ ref ì½ê¸°(ì´ì „ ê°’) â†’ ì»¤ë°‹ í›„ useEffectì—ì„œ ref ì“°ê¸°(í˜„ì¬ ê°’) |
| 4 | ê°’ ë°˜í™˜ vs í•¨ìˆ˜ ë°˜í™˜ | refë¥¼ ë Œë” ì‹œ ì½ìœ¼ë©´ ì´ì „ ê°’, í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ì½ìœ¼ë©´ ìµœì‹  ê°’ |
| 5 | useRef vs useMemo í´ë¡œì € ì„ íƒ | concurrent copy ê°„ ê³µìœ (ref) vs ë…ë¦½(í´ë¡œì €), ë Œë” ì¤‘ ìºì‹œì—” í´ë¡œì € |

ì´ ëª©ë¡ìœ¼ë¡œ ë“±ë¡í•´ë„ ë ê¹Œìš”?

---

## [12:00:50] ì‚¬ìš©ì

ë„¤

---

## [12:00:57] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__review_saveMeta

---

## [12:01:03] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__review_saveMeta

---

## [12:01:07] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__context_resolve

---

## [12:01:14] AI



> ë„êµ¬ í˜¸ì¶œ: mcp__study__review_saveMeta

---

## [12:01:17] AI

Review ë“±ë¡ ì™„ë£Œ. Phase 5 ì •ë¦¬ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.

---

## [12:01:18] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [12:01:18] AI



> ë„êµ¬ í˜¸ì¶œ: Read

---

## [12:01:22] AI



> ë„êµ¬ í˜¸ì¶œ: Edit

---

## [12:01:29] AI



> ë„êµ¬ í˜¸ì¶œ: Edit

---
